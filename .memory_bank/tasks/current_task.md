# ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è —Å MongoDB –Ω–∞ PostgreSQL 17.6 - –ó–ê–í–ï–†–®–ï–ù–ê

## –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

Family Finances Service - —ç—Ç–æ —Å–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ–º–µ–π–Ω—ã–º –±—é–¥–∂–µ—Ç–æ–º, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –Ω–∞ Clean Architecture —Å Go. –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–ª —Å MongoDB –Ω–∞ PostgreSQL 17.6 –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è ACID-–≥–∞—Ä–∞–Ω—Ç–∏–π, –±–æ–ª–µ–µ –±–æ–≥–∞—Ç–æ–≥–æ SQL-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –∏ –ª—É—á—à–µ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã (–ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
- **PostgreSQL Tables**: users, families, categories, transactions, budgets, reports
- **Domain Models**: User, Family, Category, Transaction, Budget, Report
- **Repository Pattern**: –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –Ω–∞–¥ PostgreSQL pgx –¥—Ä–∞–π–≤–µ—Ä–æ–º
- **–ò–Ω–¥–µ–∫—Å—ã**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –¢–µ–∫—É—â–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏
1. **Users**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–æ–ª—è–º–∏ (admin, member, child)
2. **Families**: –°–µ–º—å–∏ —Å –≤–∞–ª—é—Ç–æ–π
3. **Categories**: –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ—Ö–æ–¥–æ–≤/—Ä–∞—Å—Ö–æ–¥–æ–≤ —Å –∏–µ—Ä–∞—Ä—Ö–∏–µ–π
4. **Transactions**: –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å —Ç–µ–≥–∞–º–∏
5. **Budgets**: –ë—é–¥–∂–µ—Ç—ã —Å –ø–µ—Ä–∏–æ–¥–∞–º–∏ –∏ –∞–ª–µ—Ä—Ç–∞–º–∏
6. **Reports**: –û—Ç—á–µ—Ç—ã —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π

## –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏

### –§–∞–∑–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (1-2 –Ω–µ–¥–µ–ª–∏) ‚úÖ

#### 1.1 –ê–Ω–∞–ª–∏–∑ —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö ‚úÖ
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â—É—é —Å—Ö–µ–º—É MongoDB
- [x] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏
- [x] –í—ã—è–≤–∏—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è MongoDB –ø–æ–ª—è (embedded documents)
- [x] –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã –∏ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

#### 1.2 –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ PostgreSQL —Å—Ö–µ–º—ã ‚úÖ
- [x] –°–æ–∑–¥–∞—Ç—å ER-–¥–∏–∞–≥—Ä–∞–º–º—É –¥–ª—è —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π —Å—Ö–µ–º—ã
- [x] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL
- [x] –°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- [x] –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –¥–ª—è JSON –ø–æ–ª–µ–π (tags, report data)

**Phase 1 –∑–∞–≤–µ—Ä—à–µ–Ω–∞!** –°–æ–∑–¥–∞–Ω –¥–æ–∫—É–º–µ–Ω—Ç `.memory_bank/tasks/phase1_analysis.md` —Å –ø–æ–ª–Ω—ã–º –∞–Ω–∞–ª–∏–∑–æ–º –∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

### –§–∞–∑–∞ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL –æ–∫—Ä—É–∂–µ–Ω–∏—è (1 –Ω–µ–¥–µ–ª—è) ‚úÖ

#### 2.1 –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ‚úÖ
- [x] –î–æ–±–∞–≤–∏—Ç—å PostgreSQL 17.6 –≤ docker-compose.yml
- [x] –î–æ–±–∞–≤–∏—Ç—å postgres_exporter –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- [x] –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

#### 2.2 –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö ‚úÖ
- [x] –°–æ–∑–¥–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ö–µ–º—É —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ (pg-init.sql)
- [x] –î–æ–±–∞–≤–∏—Ç—å enum —Ç–∏–ø—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- [x] –°–æ–∑–¥–∞—Ç—å –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

#### 2.3 –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã ‚úÖ
- [x] –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è postgres_exporter
- [x] –û–±–Ω–æ–≤–∏—Ç—å Makefile —Å –∫–æ–º–∞–Ω–¥–∞–º–∏ –¥–ª—è PostgreSQL
- [x] –°–æ–∑–¥–∞—Ç—å .env.development –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

#### 2.4 –ò–Ω–¥–µ–∫—Å—ã –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è ‚úÖ
- [x] –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- [x] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å GIN –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è JSONB –ø–æ–ª–µ–π
- [x] –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- [x] –°–æ–∑–¥–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è

**–§–∞–∑–∞ 2 –∑–∞–≤–µ—Ä—à–µ–Ω–∞! ‚úÖ**

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

#### üìÅ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **docker/docker-compose.yml** - –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ–±–Ω–æ–≤–ª–µ–Ω —Å PostgreSQL 17.6, postgres_exporter
- **scripts/pg-init.sql** - –ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î —Å 8 —Ç–∞–±–ª–∏—Ü–∞–º–∏, –∏–Ω–¥–µ–∫—Å–∞–º–∏, —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏, –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–º–∏

#### ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- **internal/config.go** - –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å PostgreSQL, –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π, environment-aware –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- **.env.development** - –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **monitoring/postgres_exporter/queries.yaml** - 15+ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

#### üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **Makefile** - 25+ –Ω–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥ –¥–ª—è PostgreSQL, –º–∏–≥—Ä–∞—Ü–∏–π, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, backup/restore
- –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL: `postgres-up`, `postgres-shell`, `postgres-backup`
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: `postgres-stats`, `postgres-indexes`, `postgres-slow-queries`
- –ú–∏–≥—Ä–∞—Ü–∏–∏: `migrate-up`, `migrate-down`, `migrate-create`

#### üèóÔ∏è –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **–¢–∞–±–ª–∏—Ü—ã**: families, users, categories, transactions, budgets, budget_alerts, reports, user_sessions
- **–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö**: Enum —Ç–∏–ø—ã –¥–ª—è —Ä–æ–ª–µ–π, —Ç–∏–ø–æ–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –ø–µ—Ä–∏–æ–¥–æ–≤ –±—é–¥–∂–µ—Ç–∞
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**: CHECK constraints, FK constraints, UNIQUE constraints
- **–ò–Ω–¥–µ–∫—Å—ã**: 25+ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –≤–∫–ª—é—á–∞—è GIN –¥–ª—è JSONB
- **–¢—Ä–∏–≥–≥–µ—Ä—ã**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ updated_at, –ø–µ—Ä–µ—Å—á–µ—Ç –±—é–¥–∂–µ—Ç–æ–≤, –∞–ª–µ—Ä—Ç—ã

#### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å
- **PostgreSQL Exporter** —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- **–ú–µ—Ç—Ä–∏–∫–∏**: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±—é–¥–∂–µ—Ç–æ–≤, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤, cache hit ratio

### –§–∞–∑–∞ 3: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ PostgreSQL –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ (2-3 –Ω–µ–¥–µ–ª–∏)

#### 3.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–≥–æ —Å–ª–æ—è
- [x] –°–æ–∑–¥–∞—Ç—å PostgreSQL –¥—Ä–∞–π–≤–µ—Ä (`internal/infrastructure/postgresql.go`)
- [x] –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ PostgreSQL
- [x] –î–æ–±–∞–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É (golang-migrate –∏–ª–∏ atlas)

#### 3.2 –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- [x] **UserRepository**: –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å —Å –ø—Ä—è–º—ã–º–∏ SQL –∑–∞–ø—Ä–æ—Å–∞–º–∏ —á–µ—Ä–µ–∑ pgx
  - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –∏–∑–º–µ–Ω–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –Ω–∞ —á–∏—Å—Ç—ã–π SQL
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ email —á–µ—Ä–µ–∑ SQL constraints
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ–º—å–∏+–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

- [x] **FamilyRepository**: –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ PostgreSQL —Å SQL –∑–∞–ø—Ä–æ—Å–∞–º–∏
  - –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ FK constraints
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–∞–ª—é—Ç—ã —á–µ—Ä–µ–∑ CHECK constraints

- [x] **CategoryRepository**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–µ SQL –∑–∞–ø—Ä–æ—Å—ã
  - Recursive CTE –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö —Å—Å—ã–ª–æ–∫ —á–µ—Ä–µ–∑ SQL
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–∏—Å–∫–∞ –ø–æ –¥–µ—Ä–µ–≤—É —Å WITH RECURSIVE

- [x] **TransactionRepository**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã
  - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö WHERE —É—Å–ª–æ–≤–∏–π
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤
  - –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º —Å GROUP BY –∏ window functions

- [x] **BudgetRepository**: –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ SQL –∑–∞–ø—Ä–æ—Å—ã
  - –ü–æ–¥—Å—á–µ—Ç –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω–æ–≥–æ —á–µ—Ä–µ–∑ JOIN —Å transactions
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ PostgreSQL triggers –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è spent
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –ø–µ—Ä–∏–æ–¥–æ–≤ —á–µ—Ä–µ–∑ SQL constraints

- [x] **ReportRepository**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PostgreSQL –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
  - Window functions –¥–ª—è —Ç—Ä–µ–Ω–¥–æ–≤ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–π
  - Complex GROUP BY —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –∞–≥—Ä–µ–≥–∞—Ü–∏—è–º–∏
  - JSON –∞–≥—Ä–µ–≥–∞—Ü–∏—è –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ jsonb_agg()

#### 3.3 –ú–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
- [x] –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ö–µ–º—ã
- [x] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å—Ö–µ–º—ã

### –§–∞–∑–∞ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (2 –Ω–µ–¥–µ–ª–∏) ‚úÖ

#### 4.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ ‚úÖ
- [x] –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å unit —Ç–µ—Å—Ç—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
- [x] –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- [x] –°–æ–∑–¥–∞—Ç—å PostgreSQL testcontainers

#### 4.2 –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚úÖ
- [x] –ë–µ–Ω—á–º–∞—Ä–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- [x] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- [x] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ connection pool
- [x] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ PostgreSQL

#### 4.3 –ó–∞–º–µ–Ω–∞ MongoDB –Ω–∞ PostgreSQL ‚úÖ
- [x] –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ PostgreSQL
- [x] –£–¥–∞–ª–∏—Ç—å MongoDB –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ go.mod
- [x] –û—á–∏—Å—Ç–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π MongoDB –∫–æ–¥
- [x] –û–±–Ω–æ–≤–∏—Ç—å Docker Compose –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ PostgreSQL

### –§–∞–∑–∞ 5: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è (1 –Ω–µ–¥–µ–ª—è)

#### 5.1 –û—á–∏—Å—Ç–∫–∞ –∫–æ–¥–∞
- [x] –£–¥–∞–ª–µ–Ω–∏–µ MongoDB –∏–º–ø–æ—Ä—Ç–æ–≤ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- [x] –£–¥–∞–ª–µ–Ω–∏–µ MongoDB —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
- [x] –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –æ—Ç MongoDB –Ω–∞—Å—Ç—Ä–æ–µ–∫
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

#### 5.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
- [ ] –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- [x] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ CI/CD –ø–∞–π–ø–ª–∞–π–Ω–æ–≤

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```go
// go.mod –∏–∑–º–µ–Ω–µ–Ω–∏—è
- go.mongodb.org/mongo-driver v1.17.4
+ github.com/jackc/pgx/v5 v5.7.2
+ github.com/jackc/pgx/v5/pgxpool v5.7.2
+ github.com/golang-migrate/migrate/v4 v4.18.3
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```go
type PostgreSQLConfig struct {
    URI             string
    Database        string
    MaxOpenConns    int
    MaxIdleConns    int
    ConnMaxLifetime time.Duration
    SSLMode         string
    Schema          string
}
```

### –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# –ó–∞–ø—É—Å–∫ PostgreSQL –æ–∫—Ä—É–∂–µ–Ω–∏—è
make dev-up

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
make postgres-stats

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
make postgres-shell

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
make run-local

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
curl --noproxy '*' 127.0.0.1:8080/health
```

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
- **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**: http://localhost:8080
- **Prometheus**: http://localhost:9090
- **Grafana**: http://localhost:3000 (admin / admin)
- **Jaeger**: http://localhost:16686

## –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏–∏

### –†–∏—Å–∫–∏
1. **–ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤** - –¢—â–∞—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –ë–µ–Ω—á–º–∞—Ä–∫–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤
3. **–ù–∞—Ä—É—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Ç–µ—Å—Ç–æ–≤** - –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã
4. **–ü—Ä–æ–±–ª–µ–º—ã —Å —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö** - –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º—ã

### –ú–∏—Ç–∏–≥–∞—Ü–∏–∏
- –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ PostgreSQL testcontainers
- –ë–µ–Ω—á–º–∞—Ä–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º—ã –∏ –¥–∞–Ω–Ω—ã—Ö

## Timeline

| –§–∞–∑–∞ | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –°—Ç–∞—Ç—É—Å |
|------|--------------|--------|
| 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ | 1-2 –Ω–µ–¥–µ–ª–∏ | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞ |
| 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL | 1 –Ω–µ–¥–µ–ª—è | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞ |
| 3. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ | 2-3 –Ω–µ–¥–µ–ª–∏ | üöß –°–ª–µ–¥—É—é—â–∞—è |
| 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | 2 –Ω–µ–¥–µ–ª–∏ | ‚è≥ –û–∂–∏–¥–∞–µ—Ç |
| 5. –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è | 1 –Ω–µ–¥–µ–ª—è | ‚è≥ –û–∂–∏–¥–∞–µ—Ç |

**–û–±—â–∏–π —Å—Ä–æ–∫: 6-8 –Ω–µ–¥–µ–ª—å**

## –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏:
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ PostgreSQL 17.6
- ‚úÖ –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å—Ö–µ–º–∞ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ –∏ —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚è≥ ACID-–≥–∞—Ä–∞–Ω—Ç–∏–∏ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚è≥ –ë–æ–≥–∞—Ç—ã–π SQL –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚è≥ –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- ‚è≥ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

**–°—Ç–∞—Ç—É—Å**: –ú–∏–≥—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω–∞! PostgreSQL 17.6 —É—Å–ø–µ—à–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω. –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å –Ω–æ–≤–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.
