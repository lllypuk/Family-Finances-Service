# Текущие задачи проекта Family Finances Service

## Статус выполнения

**Завершено:** Задачи 1-5 (83% от общего объёма)
**Ожидает выполнения:** Задача 6 + доработки для Задачи 5

---

## Активные задачи для выполнения

---

### Задача 5.1: Доработка Invite-системы (фронтенд и тесты)

**Приоритет:** Высокий
**Статус:** Backend готов, требуется фронтенд и тесты

**Описание:**
Завершить фронтенд и тестирование для invite-системы. Бэкенд полностью реализован и проходит линтер.

**TODO:**

1. **Создать HTML шаблоны:**
   - `internal/web/templates/admin/users.html` - страница управления пользователями и приглашениями
   - `internal/web/templates/admin/invite_row.html` - HTMX partial для строки приглашения
   - `internal/web/templates/pages/invite.html` - страница регистрации по токену
   - `internal/web/templates/pages/invite_form.html` - HTMX форма регистрации

2. **Написать тесты:**
   - Unit-тесты для `internal/services/invite_service.go`
   - Integration-тесты для `internal/infrastructure/user/invite_repository_sqlite.go`
   - Тесты для веб-хэндлеров `internal/web/handlers/admin.go`

3. **Проверить:**
   - `make build` — компиляция (уже проходит ✅)
   - `make test` — все тесты проходят
   - `make lint` — 0 ошибок линтера (уже проходит ✅)

**Маршруты (уже зарегистрированы):**
- `GET /admin/users` - управление пользователями (admin only)
- `POST /admin/users/invite` - создать invite (admin only)
- `DELETE /admin/users/:id` - удалить пользователя (admin only)
- `DELETE /admin/invites/:id` - отменить invite (admin only)
- `GET /invite/:token` - страница регистрации по токену (публичная)
- `POST /invite/:token` - регистрация по токену (публичная)

---

### Задача 6: Реализовать бэкап/восстановление через интерфейс

**Приоритет:** Средний
**Статус:** Ожидает выполнения

**Описание:**
Добавить возможность скачивать и загружать файл БД (SQLite) через веб-интерфейс для резервного копирования и восстановления данных.

**Шаги:**

1. **Endpoint для скачивания бэкапа:**
   - `GET /admin/backup/download` — скачать файл БД
   - Использовать SQLite Online Backup API (или просто копию файла)
   - Content-Disposition: attachment с именем вида `family-budget-YYYY-MM-DD.db`
   - Доступ только для admin

2. **Endpoint для восстановления:**
   - `POST /admin/backup/restore` — загрузить файл БД
   - Валидация загруженного файла (проверить, что это SQLite БД)
   - Заменить текущую БД загруженным файлом
   - Перезапустить соединения с БД
   - Доступ только для admin

3. **Страница управления бэкапами:**
   - `GET /admin/backup` — UI для скачивания/загрузки
   - Показать размер текущей БД
   - Показать дату последнего бэкапа (если хранить)
   - Кнопка "Скачать бэкап"
   - Форма загрузки файла для восстановления с подтверждением

4. **Безопасность:**
   - Валидация MIME-типа и заголовка SQLite
   - Проверка целостности БД перед заменой
   - Автоматический бэкап текущей БД перед восстановлением
   - Rollback в случае ошибки

5. **Проверить:**
   - `make build`, `make test`, `make lint`
   - Ручное тестирование: скачать → удалить данные → восстановить → проверить данные

**Файлы для создания:**
- `internal/web/handlers/backup.go` (новый)
- `internal/web/templates/admin/backup.html` (новый)
- `internal/services/backup_service.go` (новый, опционально)
- `internal/web/web.go` — добавить регистрацию маршрутов

---

## Критерии завершения каждой задачи

- `make build` — проект компилируется без ошибок
- `make test` — все тесты проходят
- `make lint` — 0 ошибок линтера
- Код соответствует существующим паттернам проекта (Clean Architecture, HTMX + PicoCSS)

---

## Прогресс проекта

**Основные задачи:** 5 из 6 завершено (83%)
**Доработки:** Фронтенд и тесты для Задачи 5
