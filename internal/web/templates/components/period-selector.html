{{define "period-selector"}}
<div class="period-selector" id="period-selector">
    <div class="selector-header">
        <h3>üìÖ –ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞</h3>
        <div class="current-period">
            <span class="period-label">{{.CurrentPeriodLabel}}</span>
            <small class="text-muted">{{.PeriodDescription}}</small>
        </div>
    </div>

    <form class="period-form"
          hx-get="/htmx/dashboard/filter"
          hx-target="#dashboard-content"
          hx-swap="innerHTML"
          hx-trigger="change"
          hx-indicator="#period-loading">

        <!-- Quick Period Selection -->
        <fieldset class="quick-periods">
            <legend>–ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä</legend>
            <div class="period-buttons">
                <label class="period-option">
                    <input type="radio" name="period" value="current_month"
                           {{if and .Filters (eq .Filters.Period "current_month")}}checked{{else if not .Filters}}checked{{end}}>
                    <span>–¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</span>
                </label>
                <label class="period-option">
                    <input type="radio" name="period" value="last_month"
                           {{if and .Filters (eq .Filters.Period "last_month")}}checked{{end}}>
                    <span>–ü—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü</span>
                </label>
                <label class="period-option">
                    <input type="radio" name="period" value="last_3_months"
                           {{if and .Filters (eq .Filters.Period "last_3_months")}}checked{{end}}>
                    <span>3 –º–µ—Å—è—Ü–∞</span>
                </label>
                <label class="period-option">
                    <input type="radio" name="period" value="last_6_months"
                           {{if and .Filters (eq .Filters.Period "last_6_months")}}checked{{end}}>
                    <span>6 –º–µ—Å—è—Ü–µ–≤</span>
                </label>
                <label class="period-option">
                    <input type="radio" name="period" value="current_year"
                           {{if and .Filters (eq .Filters.Period "current_year")}}checked{{end}}>
                    <span>–¢–µ–∫—É—â–∏–π –≥–æ–¥</span>
                </label>
                <label class="period-option">
                    <input type="radio" name="period" value="custom"
                           {{if and .Filters (eq .Filters.Period "custom")}}checked{{end}}>
                    <span>–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π</span>
                </label>
            </div>
        </fieldset>

        <!-- Custom Date Range -->
        <fieldset class="custom-range"
                  style="{{if and .Filters (ne .Filters.Period "custom")}}display: none;{{else if not .Filters}}display: none;{{end}}"
                  id="custom-range">
            <legend>–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥</legend>
            <div class="date-inputs">
                <div class="date-field">
                    <label for="start_date">–û—Ç</label>
                    <input type="date"
                           id="start_date"
                           name="start_date"
                           value="{{if and .Filters .Filters.StartDate}}{{.Filters.StartDate.Format "2006-01-02"}}{{end}}"
                           max="{{.Today.Format "2006-01-02"}}">
                </div>
                <div class="date-field">
                    <label for="end_date">–î–æ</label>
                    <input type="date"
                           id="end_date"
                           name="end_date"
                           value="{{if and .Filters .Filters.EndDate}}{{.Filters.EndDate.Format "2006-01-02"}}{{end}}"
                           max="{{.Today.Format "2006-01-02"}}">
                </div>
            </div>
        </fieldset>

        <!-- Auto-refresh Settings -->
        <fieldset class="auto-refresh">
            <legend>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ</legend>
            <div class="refresh-controls">
                <label class="refresh-toggle">
                    <input type="checkbox"
                           name="auto_refresh"
                           value="true"
                           {{if .AutoRefreshEnabled}}checked{{end}}
                           hx-trigger="change"
                           hx-get="/htmx/dashboard/toggle-refresh"
                           hx-target="#refresh-status"
                           hx-swap="innerHTML">
                    <span>–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span>
                </label>
                <div id="refresh-status" class="refresh-status">
                    {{if .AutoRefreshEnabled}}
                    <small class="text-success">‚úì –í–∫–ª—é—á–µ–Ω–æ ({{.RefreshInterval}}—Å)</small>
                    {{else}}
                    <small class="text-muted">–û—Ç–∫–ª—é—á–µ–Ω–æ</small>
                    {{end}}
                </div>
            </div>
        </fieldset>

        <!-- Loading Indicator -->
        <div id="period-loading" class="htmx-indicator">
            <div class="loading-spinner">
                <span aria-busy="true">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...</span>
            </div>
        </div>
    </form>
</div>

<style>
.period-selector {
    background: var(--pico-card-background-color);
    border: 1px solid var(--pico-muted-border-color);
    border-radius: var(--pico-border-radius);
    padding: 1rem;
    margin-bottom: 1.25rem;
}

.selector-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid var(--pico-muted-border-color);
}

.selector-header h3 {
    margin: 0;
    color: var(--pico-color);
    font-size: 1.1rem;
}

.current-period {
    text-align: right;
}

.period-label {
    font-weight: bold;
    color: var(--pico-primary);
    font-size: 0.9rem;
}

.quick-periods {
    margin-bottom: 1rem;
}

.quick-periods legend {
    font-size: 0.9rem;
    font-weight: 500;
}

.period-buttons {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 0.5rem;
    margin-top: 0.5rem;
}

.period-option {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.5rem 0.75rem;
    background: var(--pico-background-color);
    border: 2px solid var(--pico-muted-border-color);
    border-radius: var(--pico-border-radius);
    cursor: pointer;
    transition: all 0.2s ease;
    margin: 0;
    font-size: 0.85rem;
}

.period-option:hover {
    border-color: var(--pico-primary);
    background: var(--pico-primary-background);
}

.period-option input[type="radio"] {
    margin: 0;
}

.period-option input[type="radio"]:checked + span {
    color: var(--pico-primary);
    font-weight: bold;
}

.period-option:has(input[type="radio"]:checked) {
    border-color: var(--pico-primary);
    background: var(--pico-primary-background);
}

.custom-range {
    margin-bottom: 1.5rem;
    transition: opacity 0.3s ease;
}

.date-inputs {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-top: 0.75rem;
}

.date-field label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
}

.auto-refresh {
    margin-bottom: 1rem;
}

.refresh-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 0.75rem;
}

.refresh-toggle {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin: 0;
}

.refresh-status {
    text-align: right;
}

.loading-spinner {
    text-align: center;
    padding: 1rem;
    background: var(--pico-primary-background);
    border-radius: var(--pico-border-radius);
    margin-top: 1rem;
}

/* Responsive Design */
@media (max-width: 768px) {
    .selector-header {
        flex-direction: column;
        gap: 0.5rem;
        align-items: flex-start;
    }

    .current-period {
        text-align: left;
        width: 100%;
    }

    .period-buttons {
        grid-template-columns: repeat(2, 1fr);
    }

    .date-inputs {
        grid-template-columns: 1fr;
    }

    .refresh-controls {
        flex-direction: column;
        gap: 0.5rem;
        align-items: flex-start;
    }

    .refresh-status {
        text-align: left;
    }
}

@media (max-width: 480px) {
    .period-buttons {
        grid-template-columns: 1fr;
    }

    .period-selector {
        padding: 1rem;
    }
}
</style>

<script>
// Show/hide custom date range based on selection
document.addEventListener('DOMContentLoaded', function() {
    const periodInputs = document.querySelectorAll('input[name="period"]');
    const customRange = document.getElementById('custom-range');

    function toggleCustomRange() {
        const selectedPeriod = document.querySelector('input[name="period"]:checked');
        if (selectedPeriod && selectedPeriod.value === 'custom') {
            customRange.style.display = 'block';
        } else {
            customRange.style.display = 'none';
        }
    }

    periodInputs.forEach(input => {
        input.addEventListener('change', toggleCustomRange);
    });

    // Validate date range
    const startDate = document.getElementById('start_date');
    const endDate = document.getElementById('end_date');

    function validateDateRange() {
        if (startDate.value && endDate.value) {
            if (new Date(startDate.value) > new Date(endDate.value)) {
                endDate.setCustomValidity('–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–∑–∂–µ –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞');
            } else {
                endDate.setCustomValidity('');
            }
        }
    }

    if (startDate && endDate) {
        startDate.addEventListener('change', validateDateRange);
        endDate.addEventListener('change', validateDateRange);
    }
});
</script>
{{end}}