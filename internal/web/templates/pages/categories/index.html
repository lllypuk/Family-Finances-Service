{{define "pages/categories/index"}}
<!doctype html>
<html lang="ru" data-theme="light">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{{.PageData.Title}} - –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</title>

        <!-- PicoCSS -->
        <link rel="stylesheet" href="/static/css/pico.min.css" />
        <link rel="stylesheet" href="/static/css/custom.css" />

        <!-- HTMX -->
        <script src="/static/js/htmx.min.js"></script>

        <!-- Favicon -->
        <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico" />
    </head>
    <body>
        <!-- Navigation -->
        <nav class="container-fluid">
            <ul>
                <li>
                    <a href="/" class="brand">
                        <strong>üí∞ –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</strong>
                    </a>
                </li>
            </ul>
            <ul>
                {{if .CurrentUser}}
                <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="/transactions">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</a></li>
                <li><a href="/categories" class="current">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a></li>
                <li><a href="/budgets">–ë—é–¥–∂–µ—Ç—ã</a></li>
                <li><a href="/reports">–û—Ç—á–µ—Ç—ã</a></li>
                <li>
                    <details class="dropdown">
                        <summary role="button" class="secondary">
                            {{.CurrentUser.FirstName}} {{.CurrentUser.LastName}}
                        </summary>
                        <ul>
                            <li><a href="/profile">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
                            {{if eq .CurrentUser.Role "admin"}}
                            <li><a href="/users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a></li>
                            <li>
                                <a href="/family/settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ–º—å–∏</a>
                            </li>
                            {{end}}
                            <li>
                                <form
                                    method="POST"
                                    action="/logout"
                                    style="margin: 0"
                                >
                                    <input
                                        type="hidden"
                                        name="_token"
                                        value="{{.CSRFToken}}"
                                    />
                                    <button type="submit" class="outline">
                                        –í—ã—Ö–æ–¥
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </details>
                </li>
                {{end}}
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="container">
            <!-- Page Header -->
            <div class="page-header">
                <div class="grid">
                    <div>
                        <h1>üìÇ {{.PageData.Title}}</h1>
                        <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</p>
                    </div>
                    <div>
                        <a href="/categories/new" role="button" class="primary">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                        </a>
                    </div>
                </div>
            </div>

            <!-- Filters Section -->
            <section class="filters-section" style="margin-bottom: 2rem">
                <details>
                    <summary role="button" class="secondary outline">
                        üîç –§–∏–ª—å—Ç—Ä—ã
                    </summary>

                    <form
                        method="GET"
                        action="/categories"
                        hx-get="/htmx/categories/filter"
                        hx-target="#categories-list"
                        hx-swap="innerHTML"
                        hx-trigger="input delay:500ms from:input, change from:select"
                        style="margin-top: 1rem"
                    >
                        <div class="grid">
                            <!-- –¢–∏–ø -->
                            <div>
                                <label for="type">
                                    –¢–∏–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                                    <select id="type" name="type">
                                        <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                                        <option value="income">
                                            üí∞ –î–æ—Ö–æ–¥—ã
                                        </option>
                                        <option value="expense">
                                            üí∏ –†–∞—Å—Ö–æ–¥—ã
                                        </option>
                                    </select>
                                </label>
                            </div>

                            <!-- –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é -->
                            <div>
                                <label for="search">
                                    –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
                                    <input
                                        type="text"
                                        id="search"
                                        name="search"
                                        value=""
                                        placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"
                                    />
                                </label>
                            </div>
                        </div>

                        <div class="grid">
                            <a
                                href="/categories"
                                role="button"
                                class="secondary outline"
                            >
                                üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                            </a>
                            <button type="submit" class="primary">
                                üîç –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                            </button>
                        </div>
                    </form>
                </details>
            </section>

            <!-- Categories Summary -->
            {{if .Categories}}
            <section class="categories-summary" style="margin-bottom: 2rem">
                <div class="grid">
                    <article class="summary-card">
                        <header>–í—Å–µ–≥–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π</header>
                        <h3>{{len .Categories}}</h3>
                    </article>

                    <article class="summary-card income">
                        <header>–î–æ—Ö–æ–¥—ã</header>
                        <h3>{{.IncomeCount}}</h3>
                    </article>

                    <article class="summary-card expense">
                        <header>–†–∞—Å—Ö–æ–¥—ã</header>
                        <h3>{{.ExpenseCount}}</h3>
                    </article>

                    <article class="summary-card">
                        <header>–° –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏</header>
                        <h3>{{.WithSubcategoriesCount}}</h3>
                    </article>
                </div>
            </section>
            {{end}}

            <!-- Categories List -->
            <section id="categories-list">
                {{if .Categories}}
                <div class="categories-grid">
                    {{range .Categories}}
                    <article class="category-card category-{{.Type}}">
                        <header>
                            <div class="category-header">
                                <h4>
                                    <span class="category-icon"
                                        >{{if eq .Type
                                        "income"}}üí∞{{else}}üí∏{{end}}</span
                                    >
                                    {{.Name}}
                                </h4>
                                <span class="category-type {{.Type}}">
                                    {{if eq .Type
                                    "income"}}–î–æ—Ö–æ–¥{{else}}–†–∞—Å—Ö–æ–¥{{end}}
                                </span>
                            </div>
                        </header>

                        <!-- Category Stats -->
                        <div class="category-stats">
                            <div class="stats-grid">
                                <div class="stat">
                                    <span class="stat-label">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</span>
                                    <span class="stat-value"
                                        >{{.TransactionCount}}</span
                                    >
                                </div>
                                <div class="stat">
                                    <span class="stat-label">–û–±—â–∞—è —Å—É–º–º–∞</span>
                                    <span class="stat-value"
                                        >{{.TotalAmount}} ‚ÇΩ</span
                                    >
                                </div>
                                {{if .LastUsed}}
                                <div class="stat">
                                    <span class="stat-label"
                                        >–ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</span
                                    >
                                    <span class="stat-value"
                                        >{{.LastUsed.Format "02.01.2006"}}</span
                                    >
                                </div>
                                {{end}}
                            </div>
                        </div>

                        <!-- Subcategories -->
                        {{if .Subcategories}}
                        <div class="subcategories">
                            <h5>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ({{len .Subcategories}})</h5>
                            <div class="subcategories-list">
                                {{range .Subcategories}}
                                <span class="subcategory-tag">
                                    {{.Name}} {{if .TransactionCount}}
                                    <small>({{.TransactionCount}})</small>
                                    {{end}}
                                </span>
                                {{end}}
                            </div>
                        </div>
                        {{end}}

                        <!-- Actions -->
                        <footer>
                            <div class="button-group">
                                <a
                                    href="/categories/{{.ID}}"
                                    role="button"
                                    class="secondary outline"
                                >
                                    üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä
                                </a>
                                <a
                                    href="/categories/{{.ID}}/edit"
                                    role="button"
                                    class="secondary outline"
                                >
                                    ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                </a>
                                <button
                                    hx-delete="/categories/{{.ID}}"
                                    hx-confirm="–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é '{{.Name}}'? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å."
                                    hx-target="closest article"
                                    hx-swap="outerHTML"
                                    class="danger outline"
                                >
                                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                </button>
                            </div>
                        </footer>
                    </article>
                    {{end}}
                </div>

                <!-- Pagination -->
                {{if .Pagination}}
                <nav class="pagination" style="margin-top: 2rem">
                    <div class="grid">
                        <div>
                            <small>
                                –ü–æ–∫–∞–∑–∞–Ω–æ {{len .Categories}} –∏–∑
                                {{.Pagination.Total}}
                            </small>
                        </div>
                        <div>
                            {{if .Pagination.HasPrev}}
                            <a href="?page=1" class="secondary outline"
                                >‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è</a
                            >
                            {{end}}

                            <span class="current-page">
                                –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{.Pagination.Page}} –∏–∑
                                {{.Pagination.TotalPages}}
                            </span>

                            {{if .Pagination.HasNext}}
                            <a
                                href="?page={{.Pagination.TotalPages}}"
                                class="secondary outline"
                                >–°–ª–µ–¥—É—é—â–∞—è ‚Üí</a
                            >
                            {{end}}
                        </div>
                    </div>
                </nav>
                {{end}} {{else}}
                <!-- Empty State -->
                <div
                    class="empty-state"
                    style="text-align: center; padding: 3rem"
                >
                    <p style="font-size: 3rem">üìÇ</p>
                    <h3>–ü–æ–∫–∞ –Ω–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π</h3>
                    <p>
                        –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –≤–∞—à–∏—Ö –¥–æ—Ö–æ–¥–æ–≤
                        –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤
                    </p>
                    <a href="/categories/new" role="button" class="primary">
                        ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                    </a>
                </div>
                {{end}}
            </section>
        </main>

        <!-- Footer -->
        <footer class="container">
            <hr />
            <div class="grid">
                <div>
                    <small>¬© 2025 –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</small>
                </div>
            </div>
        </footer>

        <!-- Custom JavaScript -->
        <script src="/static/js/app.js"></script>

        <style>
            .categories-summary {
                margin: 2rem 0;
            }

            .summary-card {
                text-align: center;
                padding: 1.5rem;
                border: 1px solid var(--pico-muted-border-color);
                border-radius: var(--pico-border-radius);
                background: var(--pico-card-background-color);
            }

            .summary-card.income {
                border-left: 4px solid #28a745;
            }

            .summary-card.expense {
                border-left: 4px solid #dc3545;
            }

            .summary-card header {
                font-size: 0.875rem;
                font-weight: 600;
                margin-bottom: 0.5rem;
                color: var(--pico-muted-color);
            }

            .summary-card h3 {
                margin: 0;
                font-size: 1.75rem;
            }

            .categories-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
                gap: 1.5rem;
                margin: 2rem 0;
            }

            .category-card {
                border: 1px solid var(--pico-muted-border-color);
                border-radius: var(--pico-border-radius);
                padding: 1.5rem;
                background: var(--pico-card-background-color);
                transition:
                    transform 0.2s ease,
                    box-shadow 0.2s ease;
            }

            .category-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            }

            .category-card.category-income {
                border-left: 4px solid #28a745;
            }

            .category-card.category-expense {
                border-left: 4px solid #dc3545;
            }

            .category-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 0.5rem;
            }

            .category-header h4 {
                margin: 0;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .category-icon {
                font-size: 1.2rem;
            }

            .category-type {
                padding: 0.25rem 0.5rem;
                border-radius: 0.25rem;
                font-size: 0.75rem;
                font-weight: 600;
                text-transform: uppercase;
            }

            .category-type.income {
                background: #d4edda;
                color: #155724;
            }

            .category-type.expense {
                background: #f8d7da;
                color: #721c24;
            }

            .category-description {
                margin: 0.5rem 0 1rem 0;
                color: var(--pico-muted-color);
                font-size: 0.875rem;
            }

            .category-stats {
                margin: 1rem 0;
                padding: 1rem;
                background: var(--pico-background-color);
                border-radius: var(--pico-border-radius);
                border: 1px solid var(--pico-muted-border-color);
            }

            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 1rem;
            }

            .stat {
                text-align: center;
            }

            .stat-label {
                display: block;
                font-size: 0.75rem;
                color: var(--pico-muted-color);
                margin-bottom: 0.25rem;
            }

            .stat-value {
                font-weight: 600;
                font-size: 0.875rem;
            }

            .subcategories {
                margin: 1rem 0;
            }

            .subcategories h5 {
                margin: 0 0 0.5rem 0;
                font-size: 0.875rem;
                color: var(--pico-muted-color);
            }

            .subcategories-list {
                display: flex;
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .subcategory-tag {
                padding: 0.25rem 0.5rem;
                background: var(--pico-muted-border-color);
                border-radius: 0.25rem;
                font-size: 0.75rem;
                color: var(--pico-color);
            }

            .button-group {
                display: flex;
                gap: 0.5rem;
                flex-wrap: wrap;
                margin-top: 1rem;
            }

            .button-group > * {
                margin: 0;
                flex: 1;
                min-width: 80px;
            }

            .empty-state h3 {
                color: var(--pico-muted-color);
            }

            @media (max-width: 768px) {
                .categories-grid {
                    grid-template-columns: 1fr;
                }

                .category-header {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: 0.5rem;
                }

                .stats-grid {
                    grid-template-columns: 1fr;
                }

                .button-group {
                    justify-content: stretch;
                }

                .button-group > * {
                    flex: 1;
                }
            }
        </style>
    </body>
</html>
{{end}}
