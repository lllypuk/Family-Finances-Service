{{define "pages/categories/new"}}
<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.PageData.Title}} - –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</title>
    
    <!-- PicoCSS -->
    <link rel="stylesheet" href="/static/css/pico.min.css">
    <link rel="stylesheet" href="/static/css/custom.css">
    
    <!-- HTMX -->
    <script src="/static/js/htmx.min.js"></script>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico">
</head>
<body>
    <!-- Navigation -->
    <nav class="container-fluid">
        <ul>
            <li>
                <a href="/" class="brand">
                    <strong>üí∞ –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</strong>
                </a>
            </li>
        </ul>
        <ul>
            {{if .CurrentUser}}
            <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
            <li><a href="/transactions">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</a></li>
            <li><a href="/categories" class="current">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a></li>
            <li><a href="/budgets">–ë—é–¥–∂–µ—Ç—ã</a></li>
            <li><a href="/reports">–û—Ç—á–µ—Ç—ã</a></li>
            <li>
                <details class="dropdown">
                    <summary role="button" class="secondary">
                        {{.CurrentUser.FirstName}} {{.CurrentUser.LastName}}
                    </summary>
                    <ul>
                        <li><a href="/profile">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
                        {{if eq .CurrentUser.Role "admin"}}
                        <li><a href="/users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a></li>
                        <li><a href="/family/settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ–º—å–∏</a></li>
                        {{end}}
                        <li>
                            <form method="POST" action="/logout" style="margin: 0;">
                                <input type="hidden" name="_token" value="{{.CSRFToken}}">
                                <button type="submit" class="outline">–í—ã—Ö–æ–¥</button>
                            </form>
                        </li>
                    </ul>
                </details>
            </li>
            {{end}}
        </ul>
    </nav>
    
    <!-- Main Content -->
    <main class="container">
        <!-- Page Header -->
        <div class="page-header">
            <div class="grid">
                <div>
                    <h1>üìÇ {{.PageData.Title}}</h1>
                    <p>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤</p>
                </div>
                <div>
                    <a href="/categories" role="button" class="secondary outline">
                        ‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
                    </a>
                </div>
            </div>
        </div>

        <article>
            <form method="POST" action="/categories">
                <!-- Form Errors -->
                {{if .PageData.Errors}}
                    <div class="alert alert-error" style="margin-bottom: 1.5rem;">
                        <h4>–û—à–∏–±–∫–∏ –≤ —Ñ–æ—Ä–º–µ:</h4>
                        <ul style="margin: 0.5rem 0 0 0;">
                            {{range $field, $error := .PageData.Errors}}
                            <li>{{$error}}</li>
                            {{end}}
                        </ul>
                    </div>
                {{end}}
                
                <!-- CSRF Token -->
                <input type="hidden" name="_token" value="{{.CSRFToken}}">

                <div class="grid">
                    <div>
                        <label for="name">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</label>
                        <input type="text" 
                               id="name" 
                               name="name" 
                               placeholder="–ü—Ä–æ–¥—É–∫—Ç—ã –ø–∏—Ç–∞–Ω–∏—è" 
                               value="{{.DefaultForm.Name}}"
                               required>
                        <small>–ö—Ä–∞—Ç–∫–æ–µ –∏ –ø–æ–Ω—è—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</small>
                    </div>
                    
                    <div>
                        <label for="type">–¢–∏–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</label>
                        <select id="type" name="type" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                            <option value="income" {{if eq .DefaultForm.Type "income"}}selected{{end}}>
                                üí∞ –î–æ—Ö–æ–¥—ã
                            </option>
                            <option value="expense" {{if eq .DefaultForm.Type "expense"}}selected{{end}}>
                                üí∏ –†–∞—Å—Ö–æ–¥—ã
                            </option>
                        </select>
                        <small>–î–æ—Ö–æ–¥—ã –∏–ª–∏ —Ä–∞—Å—Ö–æ–¥—ã</small>
                    </div>
                </div>

                <div>
                    <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <textarea id="description" 
                              name="description" 
                              rows="3" 
                              placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–æ–≥–æ, —á—Ç–æ –≤ –Ω–µ—ë –≤–∫–ª—é—á–∞—Ç—å">{{.DefaultForm.Description}}</textarea>
                    <small>–ü–æ–º–æ–≥–∞–µ—Ç –¥—Ä—É–≥–∏–º —á–ª–µ–Ω–∞–º —Å–µ–º—å–∏ –ø–æ–Ω–∏–º–∞—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</small>
                </div>

                <div class="grid">
                    <div>
                        <label for="parent_id">–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                        <select id="parent_id" name="parent_id">
                            <option value="">–û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</option>
                            {{range .ParentCategories}}
                            <option value="{{.ID}}" {{if eq .ID.String $.DefaultForm.ParentID}}selected{{end}}>
                                {{if eq .Type "income"}}üí∞{{else}}üí∏{{end}} {{.Name}}
                            </option>
                            {{end}}
                        </select>
                        <small>–í—ã–±–µ—Ä–∏—Ç–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</small>
                    </div>
                    
                    <div>
                        <label for="color">–¶–≤–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</label>
                        <input type="color" 
                               id="color" 
                               name="color" 
                               value="{{if .DefaultForm.Color}}{{.DefaultForm.Color}}{{else}}#3b82f6{{end}}">
                        <small>–¶–≤–µ—Ç –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ –æ—Ç—á–µ—Ç–∞—Ö</small>
                    </div>
                </div>

                <div class="grid">
                    <div>
                        <label for="icon">–≠–º–æ–¥–∑–∏-–∏–∫–æ–Ω–∫–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                        <input type="text" 
                               id="icon" 
                               name="icon" 
                               maxlength="2"
                               placeholder="üõí" 
                               value="{{.DefaultForm.Icon}}">
                        <small>–≠–º–æ–¥–∑–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</small>
                    </div>
                    
                    <div>
                        <label for="budget_limit">–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                        <input type="number" 
                               id="budget_limit" 
                               name="budget_limit" 
                               step="0.01" 
                               min="0"
                               placeholder="50000.00" 
                               value="{{.DefaultForm.BudgetLimit}}">
                        <small>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ª–∏–º–∏—Ç —Ç—Ä–∞—Ç –≤ –º–µ—Å—è—Ü</small>
                    </div>
                </div>

                <div>
                    <label>
                        <input type="checkbox" 
                               name="is_active" 
                               value="true" 
                               {{if .DefaultForm.IsActive}}checked{{end}}>
                        –ê–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è
                    </label>
                    <small>–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–∫—Ä—ã—Ç—ã –∏–∑ –≤—ã–±–æ—Ä–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</small>
                </div>

                <div class="button-group">
                    <button type="submit" class="primary">–°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                    <a href="/categories" role="button" class="secondary">–û—Ç–º–µ–Ω–∞</a>
                </div>
            </form>
        </article>

        <!-- Category Tips -->
        <aside style="margin-top: 2rem;">
            <details>
                <summary>üí° –°–æ–≤–µ—Ç—ã –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –∫–∞—Ç–µ–≥–æ—Ä–∏–π</summary>
                <div class="tips-content">
                    <h4>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π</h4>
                    <ul>
                        <li><strong>–ë—É–¥—å—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã:</strong> "–ü—Ä–æ–¥—É–∫—Ç—ã –ø–∏—Ç–∞–Ω–∏—è" –ª—É—á—à–µ —á–µ–º –ø—Ä–æ—Å—Ç–æ "–ï–¥–∞"</li>
                        <li><strong>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏:</strong> –î–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –±–æ–ª—å—à–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π</li>
                        <li><strong>–ï–¥–∏–Ω—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã:</strong> –°–æ–≥–ª–∞—Å—É–π—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Å —Å–µ–º—å–µ–π</li>
                        <li><strong>–ù–µ –ø–µ—Ä–µ–±–æ—Ä—â–∏—Ç–µ:</strong> –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —É—Å–ª–æ–∂–Ω—è–µ—Ç —É—á–µ—Ç</li>
                    </ul>
                    
                    <h4>–ü—Ä–∏–º–µ—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ä–∞—Å—Ö–æ–¥–æ–≤</h4>
                    <ul>
                        <li><strong>–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:</strong> –ü—Ä–æ–¥—É–∫—Ç—ã, –ö–æ–º–º—É–Ω–∞–ª–∫–∞, –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</li>
                        <li><strong>–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è:</strong> –ö–∏–Ω–æ, –†–µ—Å—Ç–æ—Ä–∞–Ω—ã, –•–æ–±–±–∏</li>
                        <li><strong>–ó–¥–æ—Ä–æ–≤—å–µ:</strong> –õ–µ–∫–∞—Ä—Å—Ç–≤–∞, –í—Ä–∞—á–∏, –°–ø–æ—Ä—Ç</li>
                        <li><strong>–°–µ–º—å—è:</strong> –î–µ—Ç–∏, –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –ü–æ–¥–∞—Ä–∫–∏</li>
                    </ul>
                    
                    <h4>–ü—Ä–∏–º–µ—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–æ—Ö–æ–¥–æ–≤</h4>
                    <ul>
                        <li><strong>–ó–∞—Ä–ø–ª–∞—Ç–∞:</strong> –û—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞, –ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞</li>
                        <li><strong>–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏:</strong> –î–∏–≤–∏–¥–µ–Ω–¥—ã, –ü—Ä–æ–¥–∞–∂–∞ –∞–∫—Ü–∏–π</li>
                        <li><strong>–ü—Ä–æ—á–µ–µ:</strong> –ü–æ–¥–∞—Ä–∫–∏, –í–æ–∑–≤—Ä–∞—Ç –¥–æ–ª–≥–æ–≤, –ö–µ—à–±—ç–∫</li>
                    </ul>
                </div>
            </details>
        </aside>
    </main>
    
    <!-- Footer -->
    <footer class="container">
        <hr>
        <div class="grid">
            <div>
                <small>¬© 2025 –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</small>
            </div>
        </div>
    </footer>
    
    <!-- Custom JavaScript -->
    <script src="/static/js/app.js"></script>
    
    <style>
        .button-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1.5rem;
        }
        
        .button-group > * {
            margin: 0;
        }

        .tips-content {
            margin-top: 1rem;
        }
        
        .tips-content h4 {
            color: var(--pico-primary);
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
        }
        
        .tips-content h4:first-child {
            margin-top: 0;
        }
        
        .tips-content ul {
            margin-bottom: 1rem;
        }
        
        .tips-content li {
            margin-bottom: 0.5rem;
        }

        aside {
            margin-top: 2rem;
        }
        
        aside details {
            background: var(--pico-background-color);
            padding: 1rem;
            border-radius: var(--pico-border-radius);
            border: 1px solid var(--pico-muted-border-color);
        }
        
        aside summary {
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 0;
        }
        
        aside summary:hover {
            color: var(--pico-primary);
        }

        .alert {
            padding: 1rem;
            border-radius: var(--pico-border-radius);
            margin-bottom: 1rem;
        }
        
        .alert.alert-error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .alert h4 {
            margin: 0 0 0.5rem 0;
        }
        
        .alert ul {
            margin: 0.5rem 0 0 1rem;
        }

        @media (max-width: 768px) {
            .button-group {
                justify-content: stretch;
            }
            
            .button-group > * {
                flex: 1;
            }
        }
    </style>
    
    <script>
        // Update parent category options when type changes
        document.getElementById('type').addEventListener('change', function() {
            const parentSelect = document.getElementById('parent_id');
            const selectedType = this.value;
            
            // Hide/show options based on type
            Array.from(parentSelect.options).forEach(option => {
                if (option.value === '') return; // Keep the empty option
                
                const optionText = option.textContent;
                const isIncomeOption = optionText.includes('üí∞');
                const isExpenseOption = optionText.includes('üí∏');
                
                if (selectedType === 'income') {
                    option.style.display = isIncomeOption ? '' : 'none';
                } else if (selectedType === 'expense') {
                    option.style.display = isExpenseOption ? '' : 'none';
                } else {
                    option.style.display = '';
                }
            });
            
            // Reset parent selection if current selection is now hidden
            if (parentSelect.value && parentSelect.options[parentSelect.selectedIndex].style.display === 'none') {
                parentSelect.value = '';
            }
        });
        
        // Trigger type change on page load to set initial state
        document.getElementById('type').dispatchEvent(new Event('change'));
    </script>
</body>
</html>
{{end}}