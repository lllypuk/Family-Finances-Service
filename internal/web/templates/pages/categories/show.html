{{define "pages/categories/show"}}
<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Category.Name}} - –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</title>
    
    <!-- PicoCSS -->
    <link rel="stylesheet" href="/static/css/pico.min.css">
    <link rel="stylesheet" href="/static/css/custom.css">
    
    <!-- HTMX -->
    <script src="/static/js/htmx.min.js"></script>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico">
</head>
<body>
    <!-- Navigation -->
    <nav class="container-fluid">
        <ul>
            <li>
                <a href="/" class="brand">
                    <strong>üí∞ –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</strong>
                </a>
            </li>
        </ul>
        <ul>
            {{if .CurrentUser}}
            <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
            <li><a href="/transactions">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</a></li>
            <li><a href="/categories" class="current">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a></li>
            <li><a href="/budgets">–ë—é–¥–∂–µ—Ç—ã</a></li>
            <li><a href="/reports">–û—Ç—á–µ—Ç—ã</a></li>
            <li>
                <details class="dropdown">
                    <summary role="button" class="secondary">
                        {{.CurrentUser.FirstName}} {{.CurrentUser.LastName}}
                    </summary>
                    <ul>
                        <li><a href="/profile">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
                        {{if eq .CurrentUser.Role "admin"}}
                        <li><a href="/users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a></li>
                        <li><a href="/family/settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ–º—å–∏</a></li>
                        {{end}}
                        <li>
                            <form method="POST" action="/logout" style="margin: 0;">
                                <input type="hidden" name="_token" value="{{.CSRFToken}}">
                                <button type="submit" class="outline">–í—ã—Ö–æ–¥</button>
                            </form>
                        </li>
                    </ul>
                </details>
            </li>
            {{end}}
        </ul>
    </nav>
    
    <!-- Main Content -->
    <main class="container">
        <!-- Page Header -->
        <div class="page-header">
            <div class="grid">
                <div>
                    <h1>
                        {{if .Category.Icon}}{{.Category.Icon}}{{else}}{{if eq .Category.Type "income"}}üí∞{{else}}üí∏{{end}}{{end}}
                        {{.Category.Name}}
                    </h1>
                    <p>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</p>
                </div>
                <div>
                    <a href="/categories" role="button" class="secondary outline">
                        ‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
                    </a>
                    <a href="/categories/{{.Category.ID}}/edit" role="button" class="secondary outline">
                        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </a>
                </div>
            </div>
        </div>

        <!-- Category Info Card -->
        <section class="category-info">
            <div class="info-card category-{{.Category.Type}}">
                <div class="info-header">
                    <div class="category-details">
                        <div class="category-type-badge {{.Category.Type}}">
                            {{if eq .Category.Type "income"}}üí∞ –î–æ—Ö–æ–¥—ã{{else}}üí∏ –†–∞—Å—Ö–æ–¥—ã{{end}}
                        </div>
                        
                        {{if .Category.Description}}
                        <p class="category-description">{{.Category.Description}}</p>
                        {{end}}
                        
                        {{if .Category.ParentCategory}}
                        <div class="parent-category">
                            <small>
                                <strong>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è:</strong>
                                <a href="/categories/{{.Category.ParentCategory.ID}}">
                                    {{.Category.ParentCategory.Name}}
                                </a>
                            </small>
                        </div>
                        {{end}}
                    </div>
                    
                    <div class="category-visual">
                        <div class="category-color-circle" style="background-color: {{.Category.Color}}"></div>
                        <div class="category-status">
                            {{if .Category.IsActive}}
                                <span class="status-badge active">‚úÖ –ê–∫—Ç–∏–≤–Ω–∞</span>
                            {{else}}
                                <span class="status-badge inactive">‚ùå –ù–µ–∞–∫—Ç–∏–≤–Ω–∞</span>
                            {{end}}
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Statistics Cards -->
        <section class="category-stats">
            <div class="grid">
                <article class="stat-card">
                    <header>–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</header>
                    <h2>{{.Category.TransactionCount}}</h2>
                    <small>
                        {{if .Category.LastUsed}}
                            –ü–æ—Å–ª–µ–¥–Ω—è—è: {{.Category.LastUsed.Format "02.01.2006"}}
                        {{else}}
                            –ï—â–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å
                        {{end}}
                    </small>
                </article>
                
                <article class="stat-card">
                    <header>–û–±—â–∞—è —Å—É–º–º–∞</header>
                    <h2 class="amount-{{.Category.Type}}">{{.Category.TotalAmount}} ‚ÇΩ</h2>
                    <small>
                        {{if gt .Category.TransactionCount 0}}
                            –í —Å—Ä–µ–¥–Ω–µ–º: {{.Category.AverageAmount}} ‚ÇΩ
                        {{else}}
                            –ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
                        {{end}}
                    </small>
                </article>
                
                <article class="stat-card">
                    <header>–≠—Ç–æ—Ç –º–µ—Å—è—Ü</header>
                    <h2 class="amount-{{.Category.Type}}">{{.Category.CurrentMonthAmount}} ‚ÇΩ</h2>
                    <small>
                        {{if .Category.BudgetLimit}}
                            –õ–∏–º–∏—Ç: {{.Category.BudgetLimit}} ‚ÇΩ
                        {{else}}
                            –õ–∏–º–∏—Ç –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
                        {{end}}
                    </small>
                </article>
                
                <article class="stat-card">
                    <header>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</header>
                    <h2>{{len .Category.Subcategories}}</h2>
                    <small>
                        {{if .Category.Subcategories}}
                            –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞
                        {{else}}
                            –û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è
                        {{end}}
                    </small>
                </article>
            </div>
        </section>

        <!-- Budget Progress (if applicable) -->
        {{if and .Category.BudgetLimit (gt .Category.BudgetLimit 0)}}
        <section class="budget-progress">
            <h3>–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –º–µ—Å—è—á–Ω–æ–º—É –ª–∏–º–∏—Ç—É</h3>
            <div class="progress-card">
                <div class="progress {{.Category.BudgetProgressClass}}" 
                     hx-get="/categories/{{.Category.ID}}/progress" 
                     hx-trigger="load, every 60s"
                     hx-swap="outerHTML">
                    <div class="progress-bar" style="width: {{if gt .Category.BudgetPercentage 100}}100{{else}}{{printf "%.1f" .Category.BudgetPercentage}}{{end}}%">
                        <span class="progress-text">{{printf "%.1f" .Category.BudgetPercentage}}%</span>
                    </div>
                </div>
                
                <div class="progress-details">
                    <div class="progress-amounts">
                        <span>–ü–æ—Ç—Ä–∞—á–µ–Ω–æ: {{.Category.CurrentMonthAmount}} ‚ÇΩ</span>
                        <span>–õ–∏–º–∏—Ç: {{.Category.BudgetLimit}} ‚ÇΩ</span>
                    </div>
                    <div class="progress-remaining {{if gt .Category.BudgetPercentage 100}}over-budget{{else}}within-budget{{end}}">
                        {{if gt .Category.BudgetPercentage 100}}
                            –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ: {{.Category.BudgetOverspent}} ‚ÇΩ
                        {{else}}
                            –û—Å—Ç–∞–µ—Ç—Å—è: {{.Category.BudgetRemaining}} ‚ÇΩ
                        {{end}}
                    </div>
                </div>
            </div>
        </section>
        {{end}}

        <!-- Subcategories -->
        {{if .Category.Subcategories}}
        <section class="subcategories-section">
            <h3>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ({{len .Category.Subcategories}})</h3>
            <div class="subcategories-grid">
                {{range .Category.Subcategories}}
                <div class="subcategory-card">
                    <div class="subcategory-header">
                        <h4>
                            <a href="/categories/{{.ID}}">{{.Name}}</a>
                        </h4>
                        {{if .IsActive}}
                            <span class="status-badge active">–ê–∫—Ç–∏–≤–Ω–∞</span>
                        {{else}}
                            <span class="status-badge inactive">–ù–µ–∞–∫—Ç–∏–≤–Ω–∞</span>
                        {{end}}
                    </div>
                    
                    <div class="subcategory-stats">
                        <span>{{.TransactionCount}} —Ç—Ä.</span>
                        <span class="amount-{{.Type}}">{{.TotalAmount}} ‚ÇΩ</span>
                    </div>
                    
                    {{if .Description}}
                    <p class="subcategory-description">{{.Description}}</p>
                    {{end}}
                </div>
                {{end}}
            </div>
            
            <div style="margin-top: 1rem;">
                <a href="/categories/new?parent_id={{.Category.ID}}" role="button" class="secondary outline">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é
                </a>
            </div>
        </section>
        {{end}}

        <!-- Recent Transactions -->
        {{if .Transactions}}
        <section class="recent-transactions">
            <h3>–ù–µ–¥–∞–≤–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h3>
            <div class="overflow-auto">
                <table role="table">
                    <thead>
                        <tr>
                            <th>–î–∞—Ç–∞</th>
                            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                            <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                            <th>–°—É–º–º–∞</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{range .Transactions}}
                        <tr>
                            <td>
                                <time datetime="{{.Date.Format "2006-01-02"}}">
                                    {{.FormattedDate}}
                                </time>
                            </td>
                            <td>
                                <strong>{{.Description}}</strong>
                                {{if .Tags}}
                                <br>
                                <div class="tags">
                                    {{range .Tags}}
                                    <span class="tag">{{.}}</span>
                                    {{end}}
                                </div>
                                {{end}}
                            </td>
                            <td>
                                {{if .UserName}}
                                <small>{{.UserName}}</small>
                                {{else}}
                                <small class="text-muted">‚Äî</small>
                                {{end}}
                            </td>
                            <td>
                                <strong class="amount-{{.Type}}">
                                    {{.FormattedAmount}} ‚ÇΩ
                                </strong>
                            </td>
                            <td>
                                <a href="/transactions/{{.ID}}/edit" 
                                   class="secondary outline"
                                   title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                    ‚úèÔ∏è
                                </a>
                            </td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
            
            <div style="margin-top: 1rem;">
                <a href="/transactions?category_id={{.Category.ID}}" role="button" class="secondary outline">
                    üìã –í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                </a>
                <a href="/transactions/new?category_id={{.Category.ID}}" role="button" class="primary">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
                </a>
            </div>
        </section>
        {{else}}
        <section class="empty-transactions">
            <div class="empty-state">
                <h3>–ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h3>
                <p>–í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –µ—â–µ –Ω–µ—Ç –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.</p>
                <a href="/transactions/new?category_id={{.Category.ID}}" role="button" class="primary">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
                </a>
            </div>
        </section>
        {{end}}
    </main>
    
    <!-- Footer -->
    <footer class="container">
        <hr>
        <div class="grid">
            <div>
                <small>¬© 2025 –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</small>
            </div>
        </div>
    </footer>
    
    <!-- Custom JavaScript -->
    <script src="/static/js/app.js"></script>
    
    <style>
        .category-info {
            margin: 2rem 0;
        }
        
        .info-card {
            padding: 2rem;
            border-radius: var(--pico-border-radius);
            border: 1px solid var(--pico-muted-border-color);
            background: var(--pico-card-background-color);
        }
        
        .info-card.category-income {
            border-left: 4px solid #28a745;
            background: #f8fff9;
        }
        
        .info-card.category-expense {
            border-left: 4px solid #dc3545;
            background: #fff8f8;
        }
        
        .info-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 2rem;
        }
        
        .category-details {
            flex: 1;
        }
        
        .category-type-badge {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
            display: inline-block;
            margin-bottom: 1rem;
        }
        
        .category-type-badge.income {
            background: #d4edda;
            color: #155724;
        }
        
        .category-type-badge.expense {
            background: #f8d7da;
            color: #721c24;
        }
        
        .category-description {
            margin: 0.5rem 0 1rem 0;
            color: var(--pico-muted-color);
            line-height: 1.6;
        }
        
        .parent-category {
            margin-top: 0.5rem;
        }
        
        .parent-category a {
            color: var(--pico-primary);
            text-decoration: none;
        }
        
        .parent-category a:hover {
            text-decoration: underline;
        }
        
        .category-visual {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }
        
        .category-color-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .status-badge.active {
            background: #d4edda;
            color: #155724;
        }
        
        .status-badge.inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .category-stats {
            margin: 2rem 0;
        }
        
        .stat-card {
            text-align: center;
            padding: 1.5rem;
            border: 1px solid var(--pico-muted-border-color);
            border-radius: var(--pico-border-radius);
            background: var(--pico-card-background-color);
        }
        
        .stat-card header {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--pico-muted-color);
        }
        
        .stat-card h2 {
            margin: 0.5rem 0;
            font-size: 1.75rem;
        }
        
        .stat-card small {
            color: var(--pico-muted-color);
        }

        .budget-progress {
            margin: 2rem 0;
        }
        
        .progress-card {
            padding: 1.5rem;
            border: 1px solid var(--pico-muted-border-color);
            border-radius: var(--pico-border-radius);
            background: var(--pico-card-background-color);
        }
        
        .progress {
            width: 100%;
            height: 24px;
            background-color: var(--pico-muted-border-color);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            margin-bottom: 1rem;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--pico-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            color: white;
            font-size: 0.875rem;
            font-weight: 600;
            text-shadow: 0 0 3px rgba(0,0,0,0.5);
        }
        
        .progress.progress-success .progress-bar { background-color: #28a745; }
        .progress.progress-warning .progress-bar { background-color: #ffc107; }
        .progress.progress-danger .progress-bar { background-color: #dc3545; }
        
        .progress-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .progress-amounts {
            display: flex;
            gap: 1rem;
            font-size: 0.875rem;
        }
        
        .progress-remaining {
            font-weight: 600;
        }
        
        .progress-remaining.within-budget {
            color: #28a745;
        }
        
        .progress-remaining.over-budget {
            color: #dc3545;
        }

        .subcategories-section {
            margin: 2rem 0;
        }
        
        .subcategories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .subcategory-card {
            padding: 1rem;
            border: 1px solid var(--pico-muted-border-color);
            border-radius: var(--pico-border-radius);
            background: var(--pico-card-background-color);
        }
        
        .subcategory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .subcategory-header h4 {
            margin: 0;
        }
        
        .subcategory-header a {
            color: var(--pico-primary);
            text-decoration: none;
        }
        
        .subcategory-header a:hover {
            text-decoration: underline;
        }
        
        .subcategory-stats {
            display: flex;
            gap: 1rem;
            margin: 0.5rem 0;
            font-size: 0.875rem;
        }
        
        .subcategory-description {
            margin: 0.5rem 0 0 0;
            color: var(--pico-muted-color);
            font-size: 0.875rem;
        }

        .recent-transactions {
            margin: 2rem 0;
        }
        
        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
            margin-top: 0.25rem;
        }
        
        .tag {
            padding: 0.125rem 0.375rem;
            background: var(--pico-muted-border-color);
            border-radius: 0.25rem;
            font-size: 0.75rem;
        }

        .empty-transactions {
            margin: 2rem 0;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
        }
        
        .empty-state h3 {
            color: var(--pico-muted-color);
        }

        .amount-income {
            color: #28a745;
        }
        
        .amount-expense {
            color: #dc3545;
        }
        
        .text-muted {
            color: var(--pico-muted-color);
        }

        @media (max-width: 768px) {
            .info-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            .category-visual {
                order: -1;
            }
            
            .progress-details {
                flex-direction: column;
                gap: 0.5rem;
                text-align: center;
            }
            
            .progress-amounts {
                flex-direction: column;
                gap: 0.25rem;
            }
            
            .subcategories-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>
{{end}}