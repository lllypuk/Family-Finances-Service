{{define "pages/reports/new"}}
<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.PageData.Title}} - –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</title>

    <!-- PicoCSS -->
    <link rel="stylesheet" href="/static/css/pico.min.css">
    <link rel="stylesheet" href="/static/css/custom.css">

    <!-- HTMX -->
    <script src="/static/js/htmx.min.js"></script>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico">
</head>
<body>
    <!-- Navigation -->
    <nav class="container-fluid">
        <ul>
            <li>
                <a href="/" class="brand">
                    <strong>üí∞ –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</strong>
                </a>
            </li>
        </ul>
        <ul>
            <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
            <li><a href="/transactions">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</a></li>
            <li><a href="/categories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a></li>
            <li><a href="/budgets">–ë—é–¥–∂–µ—Ç—ã</a></li>
            <li><a href="/reports" class="current">–û—Ç—á–µ—Ç—ã</a></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1>üìä {{.PageData.Title}}</h1>
            <nav aria-label="breadcrumb">
                <ol>
                    <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
                    <li><a href="/reports">–û—Ç—á–µ—Ç—ã</a></li>
                    <li>–°–æ–∑–¥–∞—Ç—å</li>
                </ol>
            </nav>
        </div>

        <!-- Error Messages -->
        {{if .PageData.Errors}}
        <div class="alert alert-danger" role="alert" id="form-errors">
            <ul style="margin: 0; padding-left: 1rem;">
                {{range $field, $error := .PageData.Errors}}
                <li>{{$error}}</li>
                {{end}}
            </ul>
        </div>
        {{end}}

        <!-- Create Report Form -->
        <section class="form-section">
            <div class="grid">
                <div></div>
                <div>
                    <form method="POST"
                          action="/reports"
                          hx-post="/reports"
                          hx-target="#form-errors"
                          hx-swap="outerHTML">

                        <input type="hidden" name="_token" value="{{.CSRFToken}}">

                        <!-- Report Basic Info -->
                        <fieldset>
                            <legend>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</legend>

                            <label for="name">
                                –ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ *
                                <input type="text"
                                       id="name"
                                       name="name"
                                       value="{{.Form.Name}}"
                                       placeholder="–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ —Ä–∞—Å—Ö–æ–¥–∞–º"
                                       required
                                       autofocus
                                       {{if index .PageData.Errors "name"}}aria-invalid="true"{{end}}>
                                {{if index .PageData.Errors "name"}}
                                <small class="error">{{index .PageData.Errors "name"}}</small>
                                {{end}}
                            </label>

                            <div class="grid">
                                <!-- Report Type -->
                                <div>
                                    <label for="type">
                                        –¢–∏–ø –æ—Ç—á–µ—Ç–∞ *
                                        <select id="type"
                                                name="type"
                                                required
                                                {{if index .PageData.Errors "type"}}aria-invalid="true"{{end}}>
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø...</option>
                                            <option value="expenses" {{if eq .Form.Type "expenses"}}selected{{end}}>
                                                üí∏ –û—Ç—á–µ—Ç –ø–æ —Ä–∞—Å—Ö–æ–¥–∞–º
                                            </option>
                                            <option value="income" {{if eq .Form.Type "income"}}selected{{end}}>
                                                üí∞ –û—Ç—á–µ—Ç –ø–æ –¥–æ—Ö–æ–¥–∞–º
                                            </option>
                                            <option value="budget" {{if eq .Form.Type "budget"}}selected{{end}}>
                                                üìä –ë—é–¥–∂–µ—Ç–Ω—ã–π –æ—Ç—á–µ—Ç
                                            </option>
                                            <option value="cash_flow" {{if eq .Form.Type "cash_flow"}}selected{{end}}>
                                                üíπ –î–µ–Ω–µ–∂–Ω—ã–π –ø–æ—Ç–æ–∫
                                            </option>
                                            <option value="category_breakdown" {{if eq .Form.Type "category_breakdown"}}selected{{end}}>
                                                üìã –†–∞–∑–±–∏–≤–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
                                            </option>
                                        </select>
                                        {{if index .PageData.Errors "type"}}
                                        <small class="error">{{index .PageData.Errors "type"}}</small>
                                        {{end}}
                                    </label>
                                </div>

                                <!-- Period -->
                                <div>
                                    <label for="period">
                                        –ü–µ—Ä–∏–æ–¥ *
                                        <select id="period"
                                                name="period"
                                                required
                                                onchange="updateDateFields()"
                                                {{if index .PageData.Errors "period"}}aria-invalid="true"{{end}}>
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥...</option>
                                            <option value="daily" {{if eq .Form.Period "daily"}}selected{{end}}>–ï–∂–µ–¥–Ω–µ–≤–Ω–æ</option>
                                            <option value="weekly" {{if eq .Form.Period "weekly"}}selected{{end}}>–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ</option>
                                            <option value="monthly" {{if eq .Form.Period "monthly"}}selected{{end}}>–ï–∂–µ–º–µ—Å—è—á–Ω–æ</option>
                                            <option value="quarterly" {{if eq .Form.Period "quarterly"}}selected{{end}}>–ï–∂–µ–∫–≤–∞—Ä—Ç–∞–ª—å–Ω–æ</option>
                                            <option value="yearly" {{if eq .Form.Period "yearly"}}selected{{end}}>–ï–∂–µ–≥–æ–¥–Ω–æ</option>
                                            <option value="custom" {{if eq .Form.Period "custom"}}selected{{end}}>–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥</option>
                                        </select>
                                        {{if index .PageData.Errors "period"}}
                                        <small class="error">{{index .PageData.Errors "period"}}</small>
                                        {{end}}
                                    </label>
                                </div>
                            </div>
                        </fieldset>

                        <!-- Date Range -->
                        <fieldset>
                            <legend>–ü–µ—Ä–∏–æ–¥ –æ—Ç—á–µ—Ç–∞</legend>

                            <div class="grid">
                                <div>
                                    <label for="start_date">
                                        –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ *
                                        <input type="date"
                                               id="start_date"
                                               name="start_date"
                                               value="{{.Form.StartDate}}"
                                               required
                                               {{if index .PageData.Errors "start_date"}}aria-invalid="true"{{end}}>
                                        {{if index .PageData.Errors "start_date"}}
                                        <small class="error">{{index .PageData.Errors "start_date"}}</small>
                                        {{end}}
                                    </label>
                                </div>

                                <div>
                                    <label for="end_date">
                                        –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è *
                                        <input type="date"
                                               id="end_date"
                                               name="end_date"
                                               value="{{.Form.EndDate}}"
                                               required
                                               {{if index .PageData.Errors "end_date"}}aria-invalid="true"{{end}}>
                                        {{if index .PageData.Errors "end_date"}}
                                        <small class="error">{{index .PageData.Errors "end_date"}}</small>
                                        {{end}}
                                    </label>
                                </div>
                            </div>

                            <small>–í—ã–±–µ—Ä–∏—Ç–µ –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç—á–µ—Ç–∞</small>
                        </fieldset>

                        <!-- Report Options -->
                        <fieldset>
                            <legend>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</legend>

                            <label for="description">
                                –û–ø–∏—Å–∞–Ω–∏–µ
                                <textarea id="description"
                                          name="description"
                                          placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞..."
                                          rows="3"
                                          {{if index .PageData.Errors "description"}}aria-invalid="true"{{end}}>{{.Form.Description}}</textarea>
                                {{if index .PageData.Errors "description"}}
                                <small class="error">{{index .PageData.Errors "description"}}</small>
                                {{end}}
                                <small>–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞</small>
                            </label>

                            <div class="grid">
                                <label>
                                    <input type="checkbox"
                                           name="include_charts"
                                           value="true"
                                           {{if .Form.IncludeCharts}}checked{{end}}>
                                    –í–∫–ª—é—á–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏
                                    <small>–î–æ–±–∞–≤–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ –∫ –æ—Ç—á–µ—Ç—É</small>
                                </label>

                                <label>
                                    <input type="checkbox"
                                           name="export_csv"
                                           value="true"
                                           {{if .Form.ExportCSV}}checked{{end}}>
                                    –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
                                    <small>–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª CSV –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è</small>
                                </label>
                            </div>
                        </fieldset>

                        <!-- Form Actions -->
                        <div class="grid">
                            <a href="/reports" role="button" class="secondary">
                                ‚Üê –û—Ç–º–µ–Ω–∞
                            </a>
                            <button type="submit" class="primary">
                                üìä –°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç
                            </button>
                        </div>
                    </form>
                </div>
                <div></div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="container">
        <hr>
        <div class="grid">
            <div>
                <small>¬© 2025 –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</small>
            </div>
        </div>
    </footer>

    <!-- Custom JavaScript -->
    <script src="/static/js/app.js"></script>
    <script>
        // Update date fields based on selected period
        function updateDateFields() {
            const periodSelect = document.getElementById('period');
            const startDateInput = document.getElementById('start_date');
            const endDateInput = document.getElementById('end_date');
            const selectedPeriod = periodSelect.value;

            const today = new Date();
            let startDate = new Date();
            let endDate = new Date();

            switch (selectedPeriod) {
                case 'daily':
                    startDate = new Date(today);
                    endDate = new Date(today);
                    break;
                case 'weekly':
                    startDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() - 7);
                    endDate = new Date(today);
                    break;
                case 'monthly':
                    startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                    endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                    break;
                case 'quarterly':
                    const quarter = Math.floor(today.getMonth() / 3);
                    startDate = new Date(today.getFullYear(), quarter * 3, 1);
                    endDate = new Date(today.getFullYear(), quarter * 3 + 3, 0);
                    break;
                case 'yearly':
                    startDate = new Date(today.getFullYear(), 0, 1);
                    endDate = new Date(today.getFullYear(), 11, 31);
                    break;
                case 'custom':
                    // Don't auto-fill for custom periods
                    return;
                default:
                    return;
            }

            // Format dates for input fields (YYYY-MM-DD)
            if (selectedPeriod !== 'custom') {
                startDateInput.value = startDate.toISOString().split('T')[0];
                endDateInput.value = endDate.toISOString().split('T')[0];
            }
        }

        // Initialize date fields on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateDateFields();
        });
    </script>
</body>
</html>
{{end}}
