{{define "dashboard"}}
<!doctype html>
<html lang="ru" data-theme="light">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{{.Title}} - –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</title>

        <!-- PicoCSS -->
        <link rel="stylesheet" href="/static/css/pico.min.css" />
        <link rel="stylesheet" href="/static/css/custom.css" />

        <!-- HTMX -->
        <script src="/static/js/htmx.min.js"></script>

        <!-- Favicon -->
        <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico" />
    </head>
    <body>
        <!-- Navigation -->
        <nav class="container-fluid">
            <ul>
                <li>
                    <a href="/" class="brand">
                        <strong>üí∞ –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</strong>
                    </a>
                </li>
            </ul>
            <ul>
                {{if .CurrentUser}}
                <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="/transactions">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</a></li>
                <li><a href="/categories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a></li>
                <li><a href="/budgets">–ë—é–¥–∂–µ—Ç—ã</a></li>
                <li><a href="/reports">–û—Ç—á–µ—Ç—ã</a></li>
                <li>
                    <details class="dropdown">
                        <summary role="button" class="secondary">
                            {{.CurrentUser.FirstName}} {{.CurrentUser.LastName}}
                        </summary>
                        <ul>
                            <li><a href="/profile">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
                            {{if eq .CurrentUser.Role "admin"}}
                            <li><a href="/users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a></li>
                            <li>
                                <a href="/family/settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ–º—å–∏</a>
                            </li>
                            {{end}}
                            <li>
                                <form
                                    method="POST"
                                    action="/logout"
                                    style="margin: 0"
                                >
                                    <input
                                        type="hidden"
                                        name="_token"
                                        value="{{.CSRFToken}}"
                                    />
                                    <button type="submit" class="outline">
                                        –í—ã—Ö–æ–¥
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </details>
                </li>
                {{else}}
                <li><a href="/login">–í—Ö–æ–¥</a></li>
                <li><a href="/register" role="button">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a></li>
                {{end}}
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="container">
            <!-- Flash Messages -->
            {{if .Messages}}
            <div id="flash-messages">
                {{range .Messages}}
                <div class="alert alert-{{.Type}}" role="alert">
                    {{.Text}}
                    <button type="button" class="close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                {{end}}
            </div>
            {{end}}

            <!-- Dashboard Content -->
            <div class="dashboard">
                <!-- Welcome Section -->
                <section class="welcome">
                    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{.CurrentUser.FirstName}}!</h1>
                    <p>
                        –í–æ—Ç –æ–±–∑–æ—Ä —Ñ–∏–Ω–∞–Ω—Å–æ–≤ {{if .Family}}—Å–µ–º—å–∏
                        "{{.Family.Name}}"{{else}}–≤–∞—à–µ–π —Å–µ–º—å–∏{{end}}
                    </p>
                    {{if .Filters}}
                    <div class="period-selector">
                        <small class="text-muted">
                            –ü–µ—Ä–∏–æ–¥: {{.Filters.Period}} {{if
                            .DashboardViewModel.MonthlySummary}}
                            ({{.DashboardViewModel.MonthlySummary.CurrentMonth}})
                            {{end}}
                        </small>
                    </div>
                    {{end}}
                </section>

                <!-- Stats Cards -->
                {{if .DashboardViewModel.MonthlySummary}} {{template
                "dashboard-stats" .}} {{else}}
                <section class="stats-grid">
                    <p aria-busy="true">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</p>
                </section>
                {{end}}

                <!-- Quick Actions -->
                <section class="quick-actions">
                    <h2>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
                    <div class="grid">
                        <a
                            href="/transactions/new"
                            role="button"
                            class="secondary"
                        >
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
                        </a>
                        <a href="/budgets/new" role="button" class="secondary">
                            üìä –°–æ–∑–¥–∞—Ç—å –±—é–¥–∂–µ—Ç
                        </a>
                        <a href="/reports" role="button" class="secondary">
                            üìà –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç—á–µ—Ç—ã
                        </a>
                        <a href="/categories" role="button" class="secondary">
                            üè∑Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
                        </a>
                    </div>
                </section>

                <!-- Main Dashboard Content -->
                <div class="dashboard-content">
                    <div class="grid">
                        <!-- Recent Activity -->
                        <section class="recent-activity">
                            <h2>–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h2>
                            {{if .DashboardViewModel.RecentActivity}} {{template
                            "recent-transactions" .}} {{else}}
                            <div
                                hx-get="/htmx/transactions/recent"
                                hx-trigger="load"
                                hx-target="this"
                                hx-swap="outerHTML"
                            >
                                <p aria-busy="true">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π...</p>
                            </div>
                            {{end}}
                        </section>

                        <!-- Budget Overview -->
                        <section class="budget-overview-section">
                            <h2>–°–æ—Å—Ç–æ—è–Ω–∏–µ –±—é–¥–∂–µ—Ç–æ–≤</h2>
                            {{if .DashboardViewModel.BudgetOverview}} {{template
                            "budget-overview" .}} {{else}}
                            <div
                                hx-get="/htmx/budgets/overview"
                                hx-trigger="load"
                                hx-target="this"
                                hx-swap="outerHTML"
                            >
                                <p aria-busy="true">–ó–∞–≥—Ä—É–∑–∫–∞ –±—é–¥–∂–µ—Ç–æ–≤...</p>
                            </div>
                            {{end}}
                        </section>
                    </div>

                    <!-- Category Insights -->
                    {{if .DashboardViewModel.CategoryInsights}}
                    <section class="category-insights">
                        <h2>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h2>
                        <div class="insights-content">
                            {{if
                            .DashboardViewModel.CategoryInsights.TopExpenseCategories}}
                            <div class="expense-categories">
                                <h3>–¢–æ–ø —Ä–∞—Å—Ö–æ–¥–æ–≤</h3>
                                {{range
                                .DashboardViewModel.CategoryInsights.TopExpenseCategories}}
                                <div class="category-item">
                                    <div class="category-info">
                                        {{if
                                        .CategoryIcon}}{{.CategoryIcon}}{{end}}
                                        <span class="category-name"
                                            >{{.CategoryName}}</span
                                        >
                                    </div>
                                    <div class="category-amount text-danger">
                                        {{printf "%.2f" .Amount}} ‚ÇΩ ({{printf
                                        "%.1f" .Percentage}}%)
                                    </div>
                                </div>
                                {{end}}
                            </div>
                            {{end}} {{if
                            .DashboardViewModel.CategoryInsights.TopIncomeCategories}}
                            <div class="income-categories">
                                <h3>–¢–æ–ø –¥–æ—Ö–æ–¥–æ–≤</h3>
                                {{range
                                .DashboardViewModel.CategoryInsights.TopIncomeCategories}}
                                <div class="category-item">
                                    <div class="category-info">
                                        {{if
                                        .CategoryIcon}}{{.CategoryIcon}}{{end}}
                                        <span class="category-name"
                                            >{{.CategoryName}}</span
                                        >
                                    </div>
                                    <div class="category-amount text-success">
                                        {{printf "%.2f" .Amount}} ‚ÇΩ ({{printf
                                        "%.1f" .Percentage}}%)
                                    </div>
                                </div>
                                {{end}}
                            </div>
                            {{end}}
                        </div>
                    </section>
                    {{end}}
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="container">
            <hr />
            <div class="grid">
                <div>
                    <small>
                        ¬© 2025 –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç. {{if .Family}}–°–µ–º—å—è:
                        {{.Family.Name}}{{end}}
                    </small>
                </div>
                <div>
                    <small class="text-right">
                        <a href="/help">–°–ø—Ä–∞–≤–∫–∞</a> ‚Ä¢
                        <a href="/privacy">–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</a> ‚Ä¢
                        <a href="/terms">–£—Å–ª–æ–≤–∏—è</a>
                    </small>
                </div>
            </div>
        </footer>

        <!-- Custom JavaScript -->
        <script src="/static/js/app.js"></script>

        <!-- Dashboard Styles -->
        <style>
            .dashboard {
                max-width: 1200px;
                margin: 0 auto;
            }

            .welcome {
                text-align: center;
                margin-bottom: 2rem;
            }

            .period-selector {
                margin-top: 0.5rem;
            }

            .quick-actions .grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
                margin-bottom: 2rem;
            }

            .dashboard-content .grid {
                grid-template-columns: 1fr 1fr;
                gap: 2rem;
                margin-bottom: 2rem;
            }

            .category-insights {
                margin-top: 2rem;
            }

            .insights-content {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 2rem;
            }

            .category-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.5rem 0;
                border-bottom: 1px solid var(--pico-muted-border-color);
            }

            .category-item:last-child {
                border-bottom: none;
            }

            .category-info {
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .category-amount {
                font-weight: bold;
            }

            .stats-grid {
                margin-bottom: 2rem;
            }

            .recent-activity,
            .budget-overview-section {
                background: var(--pico-card-background-color);
                border: 1px solid var(--pico-muted-border-color);
                border-radius: var(--pico-border-radius);
                padding: 1.5rem;
            }

            .recent-activity h2,
            .budget-overview-section h2 {
                margin-top: 0;
                margin-bottom: 1rem;
            }

            @media (max-width: 768px) {
                .quick-actions .grid {
                    grid-template-columns: repeat(2, 1fr);
                }

                .dashboard-content .grid {
                    grid-template-columns: 1fr;
                    gap: 1rem;
                }

                .insights-content {
                    grid-template-columns: 1fr;
                    gap: 1rem;
                }
            }
        </style>
    </body>
</html>
{{end}}
