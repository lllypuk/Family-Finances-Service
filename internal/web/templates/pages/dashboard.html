{{define "dashboard"}}
<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</title>
    
    <!-- PicoCSS -->
    <link rel="stylesheet" href="/static/css/pico.min.css">
    <link rel="stylesheet" href="/static/css/custom.css">
    
    <!-- HTMX -->
    <script src="/static/js/htmx.min.js"></script>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico">
</head>
<body>
    <!-- Navigation -->
    <nav class="container-fluid">
        <ul>
            <li>
                <a href="/" class="brand">
                    <strong>üí∞ –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</strong>
                </a>
            </li>
        </ul>
        <ul>
            {{if .CurrentUser}}
            <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
            <li><a href="/transactions">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</a></li>
            <li><a href="/categories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a></li>
            <li><a href="/budgets">–ë—é–¥–∂–µ—Ç—ã</a></li>
            <li><a href="/reports">–û—Ç—á–µ—Ç—ã</a></li>
            <li>
                <details class="dropdown">
                    <summary role="button" class="secondary">
                        {{.CurrentUser.FirstName}} {{.CurrentUser.LastName}}
                    </summary>
                    <ul>
                        <li><a href="/profile">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
                        {{if eq .CurrentUser.Role "admin"}}
                        <li><a href="/users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a></li>
                        <li><a href="/family/settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ–º—å–∏</a></li>
                        {{end}}
                        <li>
                            <form method="POST" action="/logout" style="margin: 0;">
                                <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
                                <button type="submit" class="outline">–í—ã—Ö–æ–¥</button>
                            </form>
                        </li>
                    </ul>
                </details>
            </li>
            {{else}}
            <li><a href="/login">–í—Ö–æ–¥</a></li>
            <li><a href="/register" role="button">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a></li>
            {{end}}
        </ul>
    </nav>
    
    <!-- Main Content -->
    <main class="container">
        <!-- Flash Messages -->
        {{if .Messages}}
        <div id="flash-messages">
            {{range .Messages}}
            <div class="alert alert-{{.Type}}" role="alert">
                {{.Text}}
                <button type="button" class="close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            {{end}}
        </div>
        {{end}}
        
        <!-- Dashboard Content -->
        <div class="dashboard">
            <!-- Welcome Section -->
            <section class="welcome">
                <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç!</h1>
                <p>–í–æ—Ç –æ–±–∑–æ—Ä —Ñ–∏–Ω–∞–Ω—Å–æ–≤ –≤–∞—à–µ–π —Å–µ–º—å–∏</p>
            </section>
            
            <!-- Stats Cards -->
            <section class="stats-grid" 
                     hx-get="/htmx/dashboard/stats" 
                     hx-trigger="load, every 30s"
                     hx-target="this"
                     hx-swap="outerHTML">
                
                <div class="grid">
                    <!-- Total Income Card -->
                    <article class="stat-card income">
                        <header>
                            <h3>üíµ –î–æ—Ö–æ–¥—ã</h3>
                        </header>
                        <main>
                            <h2>{{printf "%.2f" .TotalIncome}} ‚ÇΩ</h2>
                            <small>–ó–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</small>
                        </main>
                    </article>
                    
                    <!-- Total Expenses Card -->
                    <article class="stat-card expenses">
                        <header>
                            <h3>üí∏ –†–∞—Å—Ö–æ–¥—ã</h3>
                        </header>
                        <main>
                            <h2>{{printf "%.2f" .TotalExpenses}} ‚ÇΩ</h2>
                            <small>–ó–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</small>
                        </main>
                    </article>
                    
                    <!-- Net Income Card -->
                    <article class="stat-card net">
                        <header>
                            <h3>üí∞ –û—Å—Ç–∞—Ç–æ–∫</h3>
                        </header>
                        <main>
                            <h2 class="{{if lt .NetIncome 0.0}}text-danger{{else}}text-success{{end}}">
                                {{printf "%.2f" .NetIncome}} ‚ÇΩ
                            </h2>
                            <small>–î–æ—Ö–æ–¥—ã - –†–∞—Å—Ö–æ–¥—ã</small>
                        </main>
                    </article>
                </div>
            </section>
            
            <!-- Quick Actions -->
            <section class="quick-actions">
                <h2>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
                <div class="grid">
                    <a href="/transactions/new" role="button" class="secondary">
                        ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
                    </a>
                    <a href="/budgets/new" role="button" class="secondary">
                        üìä –°–æ–∑–¥–∞—Ç—å –±—é–¥–∂–µ—Ç
                    </a>
                    <a href="/reports" role="button" class="secondary">
                        üìà –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç—á–µ—Ç—ã
                    </a>
                </div>
            </section>
            
            <!-- Recent Activity -->
            <section class="recent-activity">
                <h2>–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h2>
                <div hx-get="/htmx/transactions/recent" 
                     hx-trigger="load"
                     hx-target="this"
                     hx-swap="innerHTML">
                    <p aria-busy="true">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>
            </section>
            
            <!-- Budget Overview -->
            <section class="budget-overview">
                <h2>–°–æ—Å—Ç–æ—è–Ω–∏–µ –±—é–¥–∂–µ—Ç–æ–≤</h2>
                <div hx-get="/htmx/budgets/overview" 
                     hx-trigger="load"
                     hx-target="this"
                     hx-swap="innerHTML">
                    <p aria-busy="true">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>
            </section>
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="container">
        <hr>
        <div class="grid">
            <div>
                <small>
                    ¬© 2025 –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç. 
                    {{if .Family}}–°–µ–º—å—è: {{.Family.Name}}{{end}}
                </small>
            </div>
            <div>
                <small class="text-right">
                    <a href="/help">–°–ø—Ä–∞–≤–∫–∞</a> ‚Ä¢ 
                    <a href="/privacy">–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</a> ‚Ä¢ 
                    <a href="/terms">–£—Å–ª–æ–≤–∏—è</a>
                </small>
            </div>
        </div>
    </footer>
    
    <!-- Custom JavaScript -->
    <script src="/static/js/app.js"></script>
</body>
</html>
{{end}}