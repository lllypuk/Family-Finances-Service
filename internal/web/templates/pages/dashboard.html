{{define "dashboard"}}
<!doctype html>
<html lang="ru" data-theme="light">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{{.Title}} - –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</title>

        <!-- PicoCSS -->
        <link rel="stylesheet" href="/static/css/pico.min.css" />
        <link rel="stylesheet" href="/static/css/custom.css" />
        <link rel="stylesheet" href="/static/css/compact.css" />

        <!-- HTMX -->
        <script src="/static/js/htmx.min.js"></script>

        <!-- Favicon -->
        <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico" />
    </head>
    <body>
        <!-- Navigation -->
        <nav class="container-fluid">
            <ul>
                <li>
                    <a href="/" class="brand">
                        <strong>üí∞ –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</strong>
                    </a>
                </li>
            </ul>
            <ul>
                {{if .CurrentUser}}
                <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="/transactions">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</a></li>
                <li><a href="/categories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a></li>
                <li><a href="/budgets">–ë—é–¥–∂–µ—Ç—ã</a></li>
                <li><a href="/reports">–û—Ç—á–µ—Ç—ã</a></li>
                <li>
                    <details class="dropdown">
                        <summary role="button" class="secondary">
                            {{.CurrentUser.FirstName}} {{.CurrentUser.LastName}}
                        </summary>
                        <ul>
                            <li><a href="/profile">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
                            {{if eq .CurrentUser.Role "admin"}}
                            <li><a href="/users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a></li>
                            <li>
                                <a href="/family/settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ–º—å–∏</a>
                            </li>
                            {{end}}
                            <li>
                                <form
                                    method="POST"
                                    action="/logout"
                                    style="margin: 0"
                                >
                                    <input
                                        type="hidden"
                                        name="_token"
                                        value="{{.CSRFToken}}"
                                    />
                                    <button type="submit" class="outline">
                                        –í—ã—Ö–æ–¥
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </details>
                </li>
                {{else}}
                <li><a href="/login">–í—Ö–æ–¥</a></li>
                <li><a href="/register" role="button">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a></li>
                {{end}}
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="container">
            <!-- Flash Messages -->
            {{if .Messages}}
            <div id="flash-messages">
                {{range .Messages}}
                <div class="alert alert-{{.Type}}" role="alert">
                    {{.Text}}
                    <button type="button" class="close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                {{end}}
            </div>
            {{end}}

            <!-- Dashboard Content -->
            <div class="dashboard">
                <!-- Welcome Section -->
                <section class="welcome">
                    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{.CurrentUser.FirstName}}!</h1>
                    <p>
                        –í–æ—Ç –æ–±–∑–æ—Ä —Ñ–∏–Ω–∞–Ω—Å–æ–≤ {{if .Family}}—Å–µ–º—å–∏
                        "{{.Family.Name}}"{{else}}–≤–∞—à–µ–π —Å–µ–º—å–∏{{end}}
                    </p>
                </section>

                <!-- Compact Mode Toggle -->
                <div class="compact-mode-toggle">
                    <label class="compact-toggle">
                        <input type="checkbox" id="compact-mode" />
                        <span>–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–µ–∂–∏–º</span>
                    </label>
                </div>

                <!-- Period Selector -->
                {{template "period-selector" map "Filters" .Filters "CurrentPeriodLabel" (or .DashboardViewModel.MonthlySummary.CurrentMonth "–¢–µ–∫—É—â–∏–π –ø–µ—Ä–∏–æ–¥") "PeriodDescription" "–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö" "Today" now}}

                <!-- Dashboard Content Container -->
                {{template "dashboard-content" .}}
            </div>
        </main>

        <!-- Footer -->
        <footer class="container">
            <hr />
            <div class="grid">
                <div>
                    <small>
                        ¬© 2025 –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç. {{if .Family}}–°–µ–º—å—è:
                        {{.Family.Name}}{{end}}
                    </small>
                </div>
                <div>
                    <small class="text-right">
                        <a href="/help">–°–ø—Ä–∞–≤–∫–∞</a> ‚Ä¢
                        <a href="/privacy">–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</a> ‚Ä¢
                        <a href="/terms">–£—Å–ª–æ–≤–∏—è</a>
                    </small>
                </div>
            </div>
        </footer>

        <!-- Custom JavaScript -->
        <script src="/static/js/app.js"></script>

        <!-- Compact Mode Script -->
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const compactToggle = document.getElementById("compact-mode");
                const body = document.body;

                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                const isCompact =
                    localStorage.getItem("compact-mode") === "true";
                if (isCompact) {
                    body.classList.add("compact-mode");
                    compactToggle.checked = true;
                }

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
                compactToggle.addEventListener("change", function () {
                    if (this.checked) {
                        body.classList.add("compact-mode");
                        localStorage.setItem("compact-mode", "true");
                    } else {
                        body.classList.remove("compact-mode");
                        localStorage.setItem("compact-mode", "false");
                    }
                });
            });
        </script>

        <!-- Compact Dashboard Styles -->
        <style>
            .dashboard {
                max-width: 1400px;
                margin: 0 auto;
            }

            /* –ö–æ–º–ø–∞–∫—Ç–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ */
            .welcome {
                text-align: center;
                margin-bottom: 1rem;
                padding: 0.75rem;
                background: var(--pico-primary-background);
                border-radius: var(--pico-border-radius);
            }

            .welcome h1 {
                margin: 0 0 0.25rem 0;
                font-size: 1.5rem;
            }

            .welcome p {
                margin: 0;
                font-size: 0.9rem;
                opacity: 0.8;
            }

            /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä –ø–µ—Ä–∏–æ–¥–∞ */
            .period-selector {
                margin: 0.5rem 0;
            }

            /* –£–º–µ–Ω—å—à–µ–Ω–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π */
            .quick-actions {
                margin-bottom: 1.25rem;
            }

            .quick-actions h2 {
                margin: 0 0 0.75rem 0;
                font-size: 1.1rem;
            }

            .quick-actions .grid {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
                gap: 0.75rem;
            }

            .quick-actions a[role="button"] {
                padding: 0.5rem 0.75rem;
                font-size: 0.85rem;
                text-align: center;
            }

            /* –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è —Å–µ—Ç–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
            .dashboard-content .grid {
                grid-template-columns: 1fr 1fr;
                gap: 1.25rem;
                margin-bottom: 1.25rem;
            }

            .category-insights {
                margin-top: 1.25rem;
            }

            .insights-content {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1.25rem;
            }

            /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π */
            .category-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.375rem 0;
                border-bottom: 1px solid var(--pico-muted-border-color);
            }

            .category-item:last-child {
                border-bottom: none;
            }

            .category-info {
                display: flex;
                align-items: center;
                gap: 0.375rem;
            }

            .category-amount {
                font-weight: bold;
                font-size: 0.9rem;
            }

            .stats-grid {
                margin-bottom: 1.25rem;
            }

            /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ */
            .recent-activity,
            .budget-overview-section {
                background: var(--pico-card-background-color);
                border: 1px solid var(--pico-muted-border-color);
                border-radius: var(--pico-border-radius);
                padding: 1rem;
            }

            .recent-activity h2,
            .budget-overview-section h2 {
                margin: 0 0 0.75rem 0;
                font-size: 1.1rem;
            }

            /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –∫–æ–º–ø–∞–∫—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ */
            .compact-mode-toggle {
                display: flex;
                justify-content: flex-end;
                margin-bottom: 0.75rem;
                padding: 0.5rem;
                background: var(--pico-background-color);
                border-radius: var(--pico-border-radius);
                border: 1px solid var(--pico-muted-border-color);
            }

            .compact-toggle {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                margin: 0;
                font-size: 0.9rem;
                cursor: pointer;
            }

            .compact-toggle input[type="checkbox"] {
                margin: 0;
            }

            /* –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è */
            nav.container-fluid {
                padding: 0.5rem 1rem;
            }

            nav ul li a {
                padding: 0.375rem 0.75rem;
                font-size: 0.9rem;
            }

            nav .brand strong {
                font-size: 1.1rem;
            }

            /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–µ–Ω */
            body.compact-mode .dashboard {
                max-width: 1600px;
            }

            body.compact-mode .welcome {
                padding: 0.5rem;
                margin-bottom: 0.75rem;
            }

            body.compact-mode .welcome h1 {
                font-size: 1.3rem;
            }

            body.compact-mode .welcome p {
                font-size: 0.8rem;
            }

            body.compact-mode .period-selector {
                padding: 0.75rem;
                margin-bottom: 1rem;
            }

            body.compact-mode .quick-actions .grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                gap: 0.5rem;
            }

            body.compact-mode .quick-actions a[role="button"] {
                padding: 0.375rem 0.5rem;
                font-size: 0.8rem;
            }

            body.compact-mode .dashboard-content .grid {
                gap: 1rem;
            }

            body.compact-mode .stats-grid-enhanced {
                grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
                gap: 0.75rem;
            }

            body.compact-mode .stat-card-enhanced {
                padding: 0.75rem;
            }

            body.compact-mode .recent-activity,
            body.compact-mode .budget-overview-section {
                padding: 0.75rem;
            }

            /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ñ—É—Ç–µ—Ä */
            footer.container {
                margin-top: 1.5rem;
                padding: 1rem 0;
            }

            footer small {
                font-size: 0.8rem;
            }

            /* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
            @media (max-width: 768px) {
                .welcome h1 {
                    font-size: 1.3rem;
                }

                .quick-actions .grid {
                    grid-template-columns: repeat(2, 1fr);
                    gap: 0.5rem;
                }

                .quick-actions a[role="button"] {
                    padding: 0.4rem 0.5rem;
                    font-size: 0.8rem;
                }

                .dashboard-content .grid {
                    grid-template-columns: 1fr;
                    gap: 1rem;
                }

                .insights-content {
                    grid-template-columns: 1fr;
                    gap: 1rem;
                }

                .recent-activity,
                .budget-overview-section {
                    padding: 0.75rem;
                }
            }

            @media (max-width: 480px) {
                .welcome {
                    margin-bottom: 0.75rem;
                    padding: 0.5rem;
                }

                .quick-actions .grid {
                    grid-template-columns: 1fr;
                }

                nav ul li a {
                    padding: 0.25rem 0.5rem;
                    font-size: 0.85rem;
                }
            }
        </style>
    </body>
</html>
{{end}}
