{{define "pages/budgets/new"}}
<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.PageData.Title}} - –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</title>
    
    <!-- PicoCSS -->
    <link rel="stylesheet" href="/static/css/pico.min.css">
    <link rel="stylesheet" href="/static/css/custom.css">
    
    <!-- HTMX -->
    <script src="/static/js/htmx.min.js"></script>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico">
</head>
<body>
    <!-- Navigation -->
    <nav class="container-fluid">
        <ul>
            <li>
                <a href="/" class="brand">
                    <strong>üí∞ –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</strong>
                </a>
            </li>
        </ul>
        <ul>
            {{if .CurrentUser}}
            <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
            <li><a href="/transactions">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</a></li>
            <li><a href="/categories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a></li>
            <li><a href="/budgets" class="current">–ë—é–¥–∂–µ—Ç—ã</a></li>
            <li><a href="/reports">–û—Ç—á–µ—Ç—ã</a></li>
            <li>
                <details class="dropdown">
                    <summary role="button" class="secondary">
                        {{.CurrentUser.FirstName}} {{.CurrentUser.LastName}}
                    </summary>
                    <ul>
                        <li><a href="/profile">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
                        {{if eq .CurrentUser.Role "admin"}}
                        <li><a href="/users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a></li>
                        <li><a href="/family/settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ–º—å–∏</a></li>
                        {{end}}
                        <li>
                            <form method="POST" action="/logout" style="margin: 0;">
                                <input type="hidden" name="_token" value="{{.CSRFToken}}">
                                <button type="submit" class="outline">–í—ã—Ö–æ–¥</button>
                            </form>
                        </li>
                    </ul>
                </details>
            </li>
            {{end}}
        </ul>
    </nav>
    
    <!-- Main Content -->
    <main class="container">
        <!-- Page Header -->
        <div class="page-header">
            <div class="grid">
                <div>
                    <h1>üí∞ {{.PageData.Title}}</h1>
                    <p>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –±—é–¥–∂–µ—Ç–∞</p>
                </div>
                <div>
                    <a href="/budgets" role="button" class="secondary outline">
                        ‚Üê –ù–∞–∑–∞–¥ –∫ –±—é–¥–∂–µ—Ç–∞–º
                    </a>
                </div>
            </div>
        </div>

    <article>
        <form method="POST" action="/budgets">
            <!-- Form Errors -->
            {{if .PageData.Errors}}
                <div class="alert alert-error" style="margin-bottom: 1.5rem;">
                    <h4>–û—à–∏–±–∫–∏ –≤ —Ñ–æ—Ä–º–µ:</h4>
                    <ul style="margin: 0.5rem 0 0 0;">
                        {{range $field, $error := .PageData.Errors}}
                        <li>{{$error}}</li>
                        {{end}}
                    </ul>
                </div>
            {{end}}
            
            <!-- CSRF Token -->
            <input type="hidden" name="_token" value="{{.CSRFToken}}">

            <div class="grid">
                <div>
                    <label for="name">–ù–∞–∑–≤–∞–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞</label>
                    <input type="text" 
                           id="name" 
                           name="name" 
                           placeholder="–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –±—é–¥–∂–µ—Ç –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç—ã" 
                           value="{{.DefaultForm.Name}}"
                           required>
                    <small>–î–∞–π—Ç–µ –≤–∞—à–µ–º—É –±—é–¥–∂–µ—Ç—É –ø–æ–Ω—è—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</small>
                </div>
                
                <div>
                    <label for="amount">–°—É–º–º–∞ –±—é–¥–∂–µ—Ç–∞</label>
                    <input type="number" 
                           id="amount" 
                           name="amount" 
                           step="0.01" 
                           min="0.01" 
                           placeholder="50000.00" 
                           value="{{.DefaultForm.Amount}}"
                           required>
                    <small>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –¥–ª—è —Ç—Ä–∞—Ç</small>
                </div>
            </div>

            <div class="grid">
                <div>
                    <label for="period">–ü–µ—Ä–∏–æ–¥ –±—é–¥–∂–µ—Ç–∞</label>
                    <select id="period" name="period" required>
                        <option value="weekly" {{if eq .DefaultForm.Period "weekly"}}selected{{end}}>–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ</option>
                        <option value="monthly" {{if eq .DefaultForm.Period "monthly"}}selected{{end}}>–ï–∂–µ–º–µ—Å—è—á–Ω–æ</option>
                        <option value="yearly" {{if eq .DefaultForm.Period "yearly"}}selected{{end}}>–ï–∂–µ–≥–æ–¥–Ω–æ</option>
                        <option value="custom" {{if eq .DefaultForm.Period "custom"}}selected{{end}}>–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥</option>
                    </select>
                    <small>–ù–∞ –∫–∞–∫–æ–π —Å—Ä–æ–∫ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –±—é–¥–∂–µ—Ç?</small>
                </div>
                
                <div>
                    <label for="category_id">–ö–∞—Ç–µ–≥–æ—Ä–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <select id="category_id" name="category_id">
                        <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                        {{range .CategoryOptions}}
                        <option value="{{.ID}}" {{if eq .ID $.DefaultForm.CategoryID}}selected{{end}}>
                            {{.Name}}
                        </option>
                        {{end}}
                    </select>
                    <small>–û—Å—Ç–∞–≤—å—Ç–µ "–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" –¥–ª—è –æ–±—â–µ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è —Ç—Ä–∞—Ç</small>
                </div>
            </div>

            <div class="grid">
                <div>
                    <label for="start_date">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</label>
                    <input type="date" 
                           id="start_date" 
                           name="start_date" 
                           value="{{.DefaultForm.StartDate}}"
                           required>
                </div>
                
                <div>
                    <label for="end_date">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
                    <input type="date" 
                           id="end_date" 
                           name="end_date" 
                           value="{{.DefaultForm.EndDate}}"
                           required>
                </div>
            </div>

            <div>
                <label>
                    <input type="checkbox" 
                           name="is_active" 
                           value="true" 
                           {{if .DefaultForm.IsActive}}checked{{end}}>
                    –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –±—é–¥–∂–µ—Ç —Å—Ä–∞–∑—É
                </label>
                <small>–°–Ω–∏–º–∏—Ç–µ —Ñ–ª–∞–∂–æ–∫, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–π –±—é–¥–∂–µ—Ç –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–∑–∂–µ</small>
            </div>

            <div class="button-group">
                <button type="submit" class="primary">–°–æ–∑–¥–∞—Ç—å –±—é–¥–∂–µ—Ç</button>
                <a href="/budgets" role="button" class="secondary">–û—Ç–º–µ–Ω–∞</a>
            </div>
        </form>
    </article>

        <!-- Budget Tips -->
        <aside style="margin-top: 2rem;">
            <details>
                <summary>üí° –°–æ–≤–µ—Ç—ã –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –±—é–¥–∂–µ—Ç–æ–≤</summary>
                <div class="tips-content">
                    <h4>–°–æ–∑–¥–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö –±—é–¥–∂–µ—Ç–æ–≤</h4>
                    <ul>
                        <li><strong>–ë—É–¥—å—Ç–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã:</strong> –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ —Å—É–º–º—ã, –∫–æ—Ç–æ—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –º–æ–∂–µ—Ç–µ –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è</li>
                        <li><strong>–ù–∞—á–Ω–∏—Ç–µ —Å –º–∞–ª–æ–≥–æ:</strong> –ù–∞—á–Ω–∏—Ç–µ —Å –æ–¥–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–¥—É–∫—Ç—ã) –ø–µ—Ä–µ–¥ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º</li>
                        <li><strong>–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ:</strong> –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ</li>
                        <li><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è vs –í—Å–µ:</strong> –ë—é–¥–∂–µ—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã</li>
                        <li><strong>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–∏–æ–¥–∞:</strong> –ú–µ—Å—è—á–Ω—ã–µ –±—é–¥–∂–µ—Ç—ã –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤</li>
                    </ul>
                    
                    <h4>–ü–µ—Ä–∏–æ–¥—ã –±—é–¥–∂–µ—Ç–∞</h4>
                    <ul>
                        <li><strong>–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ:</strong> –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤, —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–π, –±–µ–Ω–∑–∏–Ω–∞</li>
                        <li><strong>–ï–∂–µ–º–µ—Å—è—á–Ω–æ:</strong> –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤</li>
                        <li><strong>–ï–∂–µ–≥–æ–¥–Ω–æ:</strong> –û—Ç–ª–∏—á–Ω–æ –¥–ª—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏, –ø–æ–¥–ø–∏—Å–æ–∫, –æ—Ç–ø—É—Å–∫–∞</li>
                        <li><strong>–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ:</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤</li>
                    </ul>
                </div>
            </details>
        </aside>
    </main>
    
    <!-- Footer -->
    <footer class="container">
        <hr>
        <div class="grid">
            <div>
                <small>¬© 2025 –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</small>
            </div>
        </div>
    </footer>
    
    <!-- Custom JavaScript -->
    <script src="/static/js/app.js"></script>

<style>
    .button-group {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-top: 1.5rem;
    }
    
    .button-group > * {
        margin: 0;
    }

    .tips-content {
        margin-top: 1rem;
    }
    
    .tips-content h4 {
        color: var(--pico-primary);
        margin-top: 1.5rem;
        margin-bottom: 0.5rem;
    }
    
    .tips-content h4:first-child {
        margin-top: 0;
    }
    
    .tips-content ul {
        margin-bottom: 1rem;
    }
    
    .tips-content li {
        margin-bottom: 0.5rem;
    }

    aside {
        margin-top: 2rem;
    }
    
    aside details {
        background: var(--pico-background-color);
        padding: 1rem;
        border-radius: var(--pico-border-radius);
        border: 1px solid var(--pico-muted-border-color);
    }
    
    aside summary {
        font-weight: 600;
        cursor: pointer;
        margin-bottom: 0;
    }
    
    aside summary:hover {
        color: var(--pico-primary);
    }

    @media (max-width: 768px) {
        .button-group {
            justify-content: stretch;
        }
        
        .button-group > * {
            flex: 1;
        }
    }
</style>

    <script>
        // Auto-populate end date based on period selection
        document.getElementById('period').addEventListener('change', function() {
            const startDateInput = document.getElementById('start_date');
            const endDateInput = document.getElementById('end_date');
            const startDate = new Date(startDateInput.value);
            
            if (!startDate || isNaN(startDate)) {
                return; // No valid start date
            }
            
            let endDate = new Date(startDate);
            
            switch(this.value) {
                case 'weekly':
                    endDate.setDate(startDate.getDate() + 7);
                    break;
                case 'monthly':
                    endDate.setMonth(startDate.getMonth() + 1);
                    break;
                case 'yearly':
                    endDate.setFullYear(startDate.getFullYear() + 1);
                    break;
                default:
                    // For custom, don't auto-change
                    return;
            }
            
            // Subtract one day to make it end of period
            endDate.setDate(endDate.getDate() - 1);
            
            // Format as YYYY-MM-DD
            const year = endDate.getFullYear();
            const month = String(endDate.getMonth() + 1).padStart(2, '0');
            const day = String(endDate.getDate()).padStart(2, '0');
            
            endDateInput.value = `${year}-${month}-${day}`;
        });
        
        // Also update when start date changes
        document.getElementById('start_date').addEventListener('change', function() {
            // Trigger period change to recalculate end date
            document.getElementById('period').dispatchEvent(new Event('change'));
        });
    </script>
</body>
</html>
{{end}}