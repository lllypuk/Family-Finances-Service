{{define "pages/budgets/show"}}
<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Budget.Name}} - –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</title>

    <!-- PicoCSS -->
    <link rel="stylesheet" href="/static/css/pico.min.css">
    <link rel="stylesheet" href="/static/css/custom.css">

    <!-- HTMX -->
    <script src="/static/js/htmx.min.js"></script>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico">
</head>
<body>
    <!-- Navigation -->
    <nav class="container-fluid">
        <ul>
            <li>
                <a href="/" class="brand">
                    <strong>üí∞ –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</strong>
                </a>
            </li>
        </ul>
        <ul>
            {{if .CurrentUser}}
            <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
            <li><a href="/transactions">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</a></li>
            <li><a href="/categories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a></li>
            <li><a href="/budgets" class="current">–ë—é–¥–∂–µ—Ç—ã</a></li>
            <li><a href="/reports">–û—Ç—á–µ—Ç—ã</a></li>
            <li>
                <details class="dropdown">
                    <summary role="button" class="secondary">
                        {{.CurrentUser.FirstName}} {{.CurrentUser.LastName}}
                    </summary>
                    <ul>
                        <li><a href="/profile">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
                        {{if eq .CurrentUser.Role "admin"}}
                        <li><a href="/users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a></li>
                        <li><a href="/family/settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ–º—å–∏</a></li>
                        {{end}}
                        <li>
                            <form method="POST" action="/logout" style="margin: 0;">
                                <input type="hidden" name="_token" value="{{.CSRFToken}}">
                                <button type="submit" class="outline">–í—ã—Ö–æ–¥</button>
                            </form>
                        </li>
                    </ul>
                </details>
            </li>
            {{end}}
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="container">
        <!-- Page Header -->
        <div class="page-header">
            <div class="grid">
                <div>
                    <h1>üí∞ {{.Budget.Name}}</h1>
                    <p>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –±—é–¥–∂–µ—Ç–∞ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ç—Ä–∞—Ç</p>
                </div>
                <div>
                    <a href="/budgets" role="button" class="secondary outline">
                        ‚Üê –ù–∞–∑–∞–¥ –∫ –±—é–¥–∂–µ—Ç–∞–º
                    </a>
                    <a href="/budgets/{{.Budget.ID}}/edit" role="button" class="secondary outline">
                        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </a>
                </div>
            </div>
        </div>

        <!-- Budget Status Cards -->
        <section class="budget-overview">
            <div class="grid">
                <article class="status-card">
                    <header>–û–±—â–∏–π –±—é–¥–∂–µ—Ç</header>
                    <h2>{{.Budget.FormattedAmount}} ‚ÇΩ</h2>
                </article>

                <article class="status-card">
                    <header>–ü–æ—Ç—Ä–∞—á–µ–Ω–æ</header>
                    <h2 class="{{if .Budget.IsOverBudget}}text-danger{{else}}text-success{{end}}">
                        {{.Budget.FormattedSpent}} ‚ÇΩ
                    </h2>
                </article>

                <article class="status-card">
                    <header>–û—Å—Ç–∞–µ—Ç—Å—è</header>
                    <h2 class="{{if .Budget.IsOverBudget}}text-danger{{else}}text-success{{end}}">
                        {{.Budget.FormattedRemaining}} ‚ÇΩ
                    </h2>
                </article>

                <article class="status-card">
                    <header>–ü—Ä–æ—Ü–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</header>
                    <h2 class="{{if .Budget.IsOverBudget}}text-danger{{else if gt .Budget.Percentage 80.0}}text-warning{{else}}text-success{{end}}">
                        {{printf "%.1f" .Budget.Percentage}}%
                    </h2>
                </article>
            </div>
        </section>

        <!-- Progress Bar -->
        <section class="progress-section">
            <h3>–ü—Ä–æ–≥—Ä–µ—Å—Å —Ä–∞—Å—Ö–æ–¥–æ–≤</h3>
            <div class="progress {{.Budget.ProgressBarClass}}"
                 hx-get="/htmx/budgets/{{.Budget.ID}}/progress"
                 hx-trigger="load, every 30s"
                 hx-swap="outerHTML">
                <div class="progress-bar" style="width: {{if gt .Budget.Percentage 100.0}}100{{else}}{{printf "%.1f" .Budget.Percentage}}{{end}}%">
                    <span class="progress-text">{{printf "%.1f" .Budget.Percentage}}%</span>
                </div>
            </div>

            {{if .Budget.IsOverBudget}}
            <div class="alert alert-danger" style="margin-top: 1rem;">
                <h4>‚ö†Ô∏è –ë—é–¥–∂–µ—Ç –ø—Ä–µ–≤—ã—à–µ–Ω!</h4>
                <p>–í—ã –ø–æ—Ç—Ä–∞—Ç–∏–ª–∏ –Ω–∞ {{.Budget.FormattedOverspent}} ‚ÇΩ –±–æ–ª—å—à–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ.</p>
            </div>
            {{else if gt .Budget.Percentage 80.0}}
            <div class="alert alert-warning" style="margin-top: 1rem;">
                <h4>üö® –í–Ω–∏–º–∞–Ω–∏–µ!</h4>
                <p>–í—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –±–æ–ª–µ–µ 80% –±—é–¥–∂–µ—Ç–∞. –û—Å—Ç–∞–ª–æ—Å—å {{.Budget.FormattedRemaining}} ‚ÇΩ.</p>
            </div>
            {{end}}
        </section>

        <!-- Budget Details -->
        <section class="budget-details">
            <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—é–¥–∂–µ—Ç–µ</h3>
            <div class="grid">
                <div>
                    <h4>–ü–µ—Ä–∏–æ–¥</h4>
                    <p>{{.Budget.Period}}</p>
                    <small>{{.Budget.StartDate.Format "02.01.2006"}} - {{.Budget.EndDate.Format "02.01.2006"}}</small>
                </div>

                <div>
                    <h4>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</h4>
                    {{if .Budget.CategoryName}}
                    <p>
                        <span class="category-color" style="background-color: {{.Budget.CategoryColor}}"></span>
                        {{.Budget.CategoryName}}
                    </p>
                    {{else}}
                    <p>–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</p>
                    {{end}}
                </div>

                <div>
                    <h4>–°—Ç–∞—Ç—É—Å</h4>
                    {{if .Budget.IsActive}}
                        {{if gt .Budget.DaysLeft 0}}
                            <p class="text-success">‚úÖ –ê–∫—Ç–∏–≤–µ–Ω ({{.Budget.DaysLeft}} –¥–Ω–µ–π –æ—Å—Ç–∞–ª–æ—Å—å)</p>
                        {{else}}
                            <p class="text-warning">‚è∞ –ü—Ä–æ—Å—Ä–æ—á–µ–Ω</p>
                        {{end}}
                    {{else}}
                        <p class="text-muted">‚ùå –ù–µ–∞–∫—Ç–∏–≤–µ–Ω</p>
                    {{end}}
                </div>
            </div>
        </section>

        <!-- Related Transactions -->
        {{if .Transactions}}
        <section class="related-transactions">
            <h3>–°–≤—è–∑–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h3>
            <div class="overflow-auto">
                <table role="table">
                    <thead>
                        <tr>
                            <th>–î–∞—Ç–∞</th>
                            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                            <th>–°—É–º–º–∞</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{range .Transactions}}
                        <tr>
                            <td>
                                <time datetime="{{.Date.Format "2006-01-02"}}">
                                    {{.FormattedDate}}
                                </time>
                            </td>
                            <td>
                                <strong>{{.Description}}</strong>
                                {{if .UserName}}
                                <br><small>–æ—Ç {{.UserName}}</small>
                                {{end}}
                            </td>
                            <td>
                                <span class="category-badge category-{{.Type}}">
                                    {{if eq .Type "income"}}üí∞{{else}}üí∏{{end}}
                                    {{.CategoryName}}
                                </span>
                            </td>
                            <td>
                                <strong class="amount-{{.Type}}">
                                    {{.FormattedAmount}} ‚ÇΩ
                                </strong>
                            </td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
        </section>
        {{else}}
        <section class="empty-transactions">
            <div class="empty-state">
                <h3>–ù–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h3>
                <p>–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ —ç—Ç–æ–º –±—é–¥–∂–µ—Ç–µ –µ—â–µ –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã.</p>
                <a href="/transactions/new" role="button" class="primary">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
                </a>
            </div>
        </section>
        {{end}}
    </main>

    <!-- Footer -->
    <footer class="container">
        <hr>
        <div class="grid">
            <div>
                <small>¬© 2025 –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</small>
            </div>
        </div>
    </footer>

    <!-- Custom JavaScript -->
    <script src="/static/js/app.js"></script>

<style>
    .budget-overview {
        margin: 2rem 0;
    }

    .status-card {
        text-align: center;
        padding: 1.5rem;
        border: 1px solid var(--pico-muted-border-color);
        border-radius: var(--pico-border-radius);
    }

    .status-card header {
        font-size: 0.875rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--pico-muted-color);
    }

    .status-card h2 {
        margin: 0;
        font-size: 1.75rem;
    }

    .progress-section {
        margin: 2rem 0;
    }

    .progress {
        width: 100%;
        height: 24px;
        background-color: var(--pico-muted-border-color);
        border-radius: 12px;
        overflow: hidden;
        position: relative;
        margin: 1rem 0;
    }

    .progress-bar {
        height: 100%;
        background-color: var(--pico-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 12px;
        transition: width 0.3s ease;
        position: relative;
    }

    .progress-text {
        color: white;
        font-size: 0.875rem;
        font-weight: 600;
        text-shadow: 0 0 3px rgba(0,0,0,0.5);
    }

    .progress.progress-success .progress-bar { background-color: #28a745; }
    .progress.progress-info .progress-bar { background-color: #17a2b8; }
    .progress.progress-warning .progress-bar { background-color: #ffc107; }
    .progress.progress-danger .progress-bar { background-color: #dc3545; }

    .budget-details {
        margin: 2rem 0;
        padding: 1.5rem;
        background: var(--pico-background-color);
        border-radius: var(--pico-border-radius);
        border: 1px solid var(--pico-muted-border-color);
    }

    .budget-details h4 {
        margin-bottom: 0.5rem;
        color: var(--pico-primary);
    }

    .budget-details p {
        margin: 0 0 0.25rem 0;
    }

    .category-color {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 0.5rem;
    }

    .related-transactions {
        margin: 2rem 0;
    }

    .empty-transactions {
        margin: 2rem 0;
    }

    .empty-state {
        text-align: center;
        padding: 3rem 1rem;
    }

    .empty-state h3 {
        color: var(--pico-muted-color);
    }

    .text-success { color: #28a745; }
    .text-warning { color: #ffc107; }
    .text-danger { color: #dc3545; }
    .text-muted { color: var(--pico-muted-color); }

    .alert {
        padding: 1rem;
        border-radius: var(--pico-border-radius);
        margin-bottom: 1rem;
    }

    .alert.alert-danger {
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
    }

    .alert.alert-warning {
        background-color: #fff3cd;
        border: 1px solid #ffeaa7;
        color: #856404;
    }

    .alert h4 {
        margin: 0 0 0.5rem 0;
    }

    .alert p {
        margin: 0;
    }

    @media (max-width: 768px) {
        .status-card {
            padding: 1rem;
        }

        .status-card h2 {
            font-size: 1.5rem;
        }
    }
</style>
</body>
</html>
{{end}}
