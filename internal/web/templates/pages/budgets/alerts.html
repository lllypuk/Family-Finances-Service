{{define "pages/budgets/alerts"}}
<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.PageData.Title}} - –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</title>
    
    <!-- PicoCSS -->
    <link rel="stylesheet" href="/static/css/pico.min.css">
    <link rel="stylesheet" href="/static/css/custom.css">
    
    <!-- HTMX -->
    <script src="/static/js/htmx.min.js"></script>
    
    <!-- CSRF Token for HTMX -->
    {{if .CSRFToken}}<meta name="csrf-token" content="{{.CSRFToken}}">{{end}}
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico">
</head>
<body>
    <!-- Navigation -->
    <nav class="container-fluid">
        <ul>
            <li>
                <a href="/" class="brand">
                    <strong>üí∞ –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</strong>
                </a>
            </li>
        </ul>
        <ul>
            {{if .CurrentUser}}
            <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
            <li><a href="/transactions">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</a></li>
            <li><a href="/categories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a></li>
            <li><a href="/budgets" class="current">–ë—é–¥–∂–µ—Ç—ã</a></li>
            <li><a href="/reports">–û—Ç—á–µ—Ç—ã</a></li>
            <li>
                <details class="dropdown">
                    <summary role="button" class="secondary">
                        {{.CurrentUser.FirstName}} {{.CurrentUser.LastName}}
                    </summary>
                    <ul>
                        <li><a href="/profile">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
                        {{if eq .CurrentUser.Role "admin"}}
                        <li><a href="/users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a></li>
                        <li><a href="/family/settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ–º—å–∏</a></li>
                        {{end}}
                        <li>
                            <form method="POST" action="/logout" style="margin: 0;">
                                <input type="hidden" name="_token" value="{{.CSRFToken}}">
                                <button type="submit" class="outline">–í—ã—Ö–æ–¥</button>
                            </form>
                        </li>
                    </ul>
                </details>
            </li>
            {{end}}
        </ul>
    </nav>
    
    <!-- Main Content -->
    <main class="container">
        <!-- Page Header -->
        <div class="page-header">
            <div class="grid">
                <div>
                    <h1>üö® {{.PageData.Title}}</h1>
                    <p>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø–æ –±—é–¥–∂–µ—Ç–∞–º</p>
                </div>
                <div>
                    <a href="/budgets" role="button" class="secondary outline">
                        ‚Üê –ù–∞–∑–∞–¥ –∫ –±—é–¥–∂–µ—Ç–∞–º
                    </a>
                </div>
            </div>
        </div>

        <!-- Alert Summary -->
        <section class="alert-summary">
            <div class="grid">
                <article class="summary-card">
                    <header>–í—Å–µ–≥–æ –±—é–¥–∂–µ—Ç–æ–≤</header>
                    <h3>{{.TotalCount}}</h3>
                </article>
                
                <article class="summary-card critical">
                    <header>–ü—Ä–µ–≤—ã—à–µ–Ω–Ω—ã–µ</header>
                    <h3>{{.OverBudgetCount}}</h3>
                </article>
                
                <article class="summary-card warning">
                    <header>–ë–ª–∏–∑–∫–∏–µ –∫ –ª–∏–º–∏—Ç—É</header>
                    <h3>{{.WarningCount}}</h3>
                </article>
                
                <article class="summary-card success">
                    <header>–í –Ω–æ—Ä–º–µ</header>
                    <h3>{{.NormalCount}}</h3>
                </article>
            </div>
        </section>

        <!-- Critical Alerts (Over Budget) -->
        {{if .OverBudgetAlerts}}
        <section class="alerts-section critical">
            <h2>‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h2>
            <p class="section-description">–ë—é–¥–∂–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–≤—ã—Å–∏–ª–∏ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—É–º–º—É</p>
            
            <div class="alerts-grid">
                {{range .OverBudgetAlerts}}
                <article class="alert-card critical">
                    <header>
                        <h4>{{.Name}}</h4>
                        <span class="alert-badge critical">–ü—Ä–µ–≤—ã—à–µ–Ω –Ω–∞ {{.OverspentFormatted}} ‚ÇΩ</span>
                    </header>
                    
                    <div class="alert-content">
                        <div class="progress-mini critical">
                            <div class="progress-bar" style="width: 100%"></div>
                        </div>
                        
                        <div class="alert-details">
                            <div class="detail">
                                <strong>–ü–æ—Ç—Ä–∞—á–µ–Ω–æ:</strong> {{.SpentFormatted}} ‚ÇΩ –∏–∑ {{.AmountFormatted}} ‚ÇΩ
                            </div>
                            <div class="detail">
                                <strong>–ü–µ—Ä–∏–æ–¥:</strong> {{.Period}} ({{.StartDate.Format "02.01.2006"}} - {{.EndDate.Format "02.01.2006"}})
                            </div>
                            {{if .CategoryName}}
                            <div class="detail">
                                <strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> {{.CategoryName}}
                            </div>
                            {{end}}
                        </div>
                    </div>
                    
                    <footer>
                        <div class="button-group">
                            <a href="/budgets/{{.ID}}" role="button" class="secondary outline">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å</a>
                            <a href="/budgets/{{.ID}}/edit" role="button" class="secondary outline">–ò–∑–º–µ–Ω–∏—Ç—å –ª–∏–º–∏—Ç</a>
                        </div>
                    </footer>
                </article>
                {{end}}
            </div>
        </section>
        {{end}}

        <!-- Warning Alerts (Close to Budget) -->
        {{if .WarningAlerts}}
        <section class="alerts-section warning">
            <h2>üî∂ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è</h2>
            <p class="section-description">–ë—é–¥–∂–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –±–ª–∏–∑–∫–∏ –∫ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—é (80%+ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ)</p>
            
            <div class="alerts-grid">
                {{range .WarningAlerts}}
                <article class="alert-card warning">
                    <header>
                        <h4>{{.Name}}</h4>
                        <span class="alert-badge warning">{{printf "%.1f" .Percentage}}% –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ</span>
                    </header>
                    
                    <div class="alert-content">
                        <div class="progress-mini warning">
                            <div class="progress-bar" style="width: {{printf "%.1f" .Percentage}}%"></div>
                        </div>
                        
                        <div class="alert-details">
                            <div class="detail">
                                <strong>–ü–æ—Ç—Ä–∞—á–µ–Ω–æ:</strong> {{.SpentFormatted}} ‚ÇΩ –∏–∑ {{.AmountFormatted}} ‚ÇΩ
                            </div>
                            <div class="detail">
                                <strong>–û—Å—Ç–∞–ª–æ—Å—å:</strong> {{.RemainingFormatted}} ‚ÇΩ
                            </div>
                            <div class="detail">
                                <strong>–î–Ω–µ–π –¥–æ –∫–æ–Ω—Ü–∞:</strong> {{.DaysLeft}}
                            </div>
                            {{if .CategoryName}}
                            <div class="detail">
                                <strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> {{.CategoryName}}
                            </div>
                            {{end}}
                        </div>
                    </div>
                    
                    <footer>
                        <div class="button-group">
                            <a href="/budgets/{{.ID}}" role="button" class="secondary outline">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å</a>
                            <a href="/budgets/{{.ID}}/edit" role="button" class="secondary outline">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                        </div>
                    </footer>
                </article>
                {{end}}
            </div>
        </section>
        {{end}}

        <!-- Expired Budgets -->
        {{if .ExpiredAlerts}}
        <section class="alerts-section expired">
            <h2>‚è∞ –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –±—é–¥–∂–µ—Ç—ã</h2>
            <p class="section-description">–ë—é–¥–∂–µ—Ç—ã —Å –∏—Å—Ç–µ–∫—à–∏–º —Å—Ä–æ–∫–æ–º –¥–µ–π—Å—Ç–≤–∏—è</p>
            
            <div class="alerts-grid">
                {{range .ExpiredAlerts}}
                <article class="alert-card expired">
                    <header>
                        <h4>{{.Name}}</h4>
                        <span class="alert-badge expired">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω {{.DaysExpired}} –¥–Ω. –Ω–∞–∑–∞–¥</span>
                    </header>
                    
                    <div class="alert-content">
                        <div class="alert-details">
                            <div class="detail">
                                <strong>–ü–µ—Ä–∏–æ–¥:</strong> {{.StartDate.Format "02.01.2006"}} - {{.EndDate.Format "02.01.2006"}}
                            </div>
                            <div class="detail">
                                <strong>–§–∏–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–∞—Ç—ã:</strong> {{.SpentFormatted}} ‚ÇΩ –∏–∑ {{.AmountFormatted}} ‚ÇΩ
                            </div>
                            {{if .CategoryName}}
                            <div class="detail">
                                <strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> {{.CategoryName}}
                            </div>
                            {{end}}
                        </div>
                    </div>
                    
                    <footer>
                        <div class="button-group">
                            <a href="/budgets/{{.ID}}" role="button" class="secondary outline">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å</a>
                            <button hx-post="/budgets/{{.ID}}/archive" 
                                    hx-target="closest article" 
                                    hx-swap="outerHTML"
                                    class="secondary outline">
                                –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                        </div>
                    </footer>
                </article>
                {{end}}
            </div>
        </section>
        {{end}}

        <!-- No Alerts State -->
        {{if and (not .OverBudgetAlerts) (not .WarningAlerts) (not .ExpiredAlerts)}}
        <section class="empty-alerts">
            <div class="empty-state">
                <h3>‚úÖ –í—Å–µ –±—é–¥–∂–µ—Ç—ã –≤ –ø–æ—Ä—è–¥–∫–µ!</h3>
                <p>–í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏–ª–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π.</p>
                <a href="/budgets" role="button" class="primary">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –±—é–¥–∂–µ—Ç–∞–º</a>
            </div>
        </section>
        {{end}}

        <!-- Alert Settings -->
        <section class="alert-settings">
            <details>
                <summary>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</summary>
                <div class="settings-content">
                    <h4>–ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è</h4>
                    <form method="POST" action="/budgets/alerts/settings">
                        <input type="hidden" name="_token" value="{{.CSRFToken}}">
                        
                        <div class="grid">
                            <div>
                                <label for="warning_threshold">–ü–æ—Ä–æ–≥ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (%)</label>
                                <input type="number" 
                                       id="warning_threshold" 
                                       name="warning_threshold" 
                                       min="50" 
                                       max="95" 
                                       value="{{.Settings.WarningThreshold}}"
                                       step="5">
                                <small>–ü—Ä–∏ –∫–∞–∫–æ–º –ø—Ä–æ—Ü–µ–Ω—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ</small>
                            </div>
                            
                            <div>
                                <label>
                                    <input type="checkbox" 
                                           name="email_notifications" 
                                           {{if .Settings.EmailNotifications}}checked{{end}}>
                                    Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                                </label>
                                <small>–ü–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞ email</small>
                            </div>
                        </div>
                        
                        <div class="button-group">
                            <button type="submit" class="primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                        </div>
                    </form>
                </div>
            </details>
        </section>
    </main>
    
    <!-- Footer -->
    <footer class="container">
        <hr>
        <div class="grid">
            <div>
                <small>¬© 2025 –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</small>
            </div>
        </div>
    </footer>
    
    <!-- Custom JavaScript -->
    <script src="/static/js/app.js"></script>

<style>
    .alert-summary {
        margin: 2rem 0;
    }
    
    .summary-card {
        text-align: center;
        padding: 1.5rem;
        border-radius: var(--pico-border-radius);
        border: 2px solid var(--pico-muted-border-color);
        background: var(--pico-card-background-color);
    }
    
    .summary-card.critical {
        border-color: #dc3545;
        background: #fdf2f2;
    }
    
    .summary-card.warning {
        border-color: #ffc107;
        background: #fffef0;
    }
    
    .summary-card.success {
        border-color: #28a745;
        background: #f0f9f0;
    }
    
    .summary-card header {
        font-size: 0.875rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--pico-muted-color);
    }
    
    .summary-card h3 {
        margin: 0;
        font-size: 2rem;
    }

    .alerts-section {
        margin: 3rem 0;
    }
    
    .section-description {
        color: var(--pico-muted-color);
        margin-bottom: 1.5rem;
    }

    .alerts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 1.5rem;
    }

    .alert-card {
        border-radius: var(--pico-border-radius);
        padding: 1.5rem;
        border: 2px solid;
        background: var(--pico-card-background-color);
    }
    
    .alert-card.critical {
        border-color: #dc3545;
        background: #fdf2f2;
    }
    
    .alert-card.warning {
        border-color: #ffc107;
        background: #fffef0;
    }
    
    .alert-card.expired {
        border-color: #6c757d;
        background: #f8f9fa;
    }

    .alert-card header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }
    
    .alert-card h4 {
        margin: 0;
    }

    .alert-badge {
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
    }
    
    .alert-badge.critical {
        background: #dc3545;
        color: white;
    }
    
    .alert-badge.warning {
        background: #ffc107;
        color: #856404;
    }
    
    .alert-badge.expired {
        background: #6c757d;
        color: white;
    }

    .progress-mini {
        height: 8px;
        background: var(--pico-muted-border-color);
        border-radius: 4px;
        overflow: hidden;
        margin: 1rem 0;
    }
    
    .progress-mini .progress-bar {
        height: 100%;
        border-radius: 4px;
        transition: width 0.3s ease;
    }
    
    .progress-mini.critical .progress-bar {
        background: #dc3545;
    }
    
    .progress-mini.warning .progress-bar {
        background: #ffc107;
    }

    .alert-details {
        margin: 1rem 0;
    }
    
    .alert-details .detail {
        margin-bottom: 0.5rem;
        font-size: 0.875rem;
    }

    .button-group {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-top: 1rem;
    }
    
    .button-group > * {
        margin: 0;
    }

    .empty-alerts {
        margin: 3rem 0;
        text-align: center;
    }
    
    .empty-state {
        padding: 3rem 1rem;
    }
    
    .empty-state h3 {
        color: #28a745;
    }

    .alert-settings {
        margin: 3rem 0;
    }
    
    .settings-content {
        margin-top: 1rem;
        padding: 1.5rem;
        background: var(--pico-background-color);
        border-radius: var(--pico-border-radius);
        border: 1px solid var(--pico-muted-border-color);
    }

    @media (max-width: 768px) {
        .alerts-grid {
            grid-template-columns: 1fr;
        }
        
        .alert-card header {
            flex-direction: column;
            align-items: flex-start;
            gap: 0.5rem;
        }
        
        .button-group {
            justify-content: stretch;
        }
        
        .button-group > * {
            flex: 1;
        }
    }
</style>
</body>
</html>
{{end}}