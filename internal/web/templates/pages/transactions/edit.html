{{define "pages/transactions/edit"}}
<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.PageData.Title}} - –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</title>
    
    <!-- PicoCSS -->
    <link rel="stylesheet" href="/static/css/pico.min.css">
    <link rel="stylesheet" href="/static/css/custom.css">
    
    <!-- HTMX -->
    <script src="/static/js/htmx.min.js"></script>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico">
</head>
<body>
    <!-- Navigation -->
    <nav class="container-fluid">
        <ul>
            <li>
                <a href="/" class="brand">
                    <strong>üí∞ –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</strong>
                </a>
            </li>
        </ul>
        <ul>
            <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
            <li><a href="/transactions" class="current">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</a></li>
            <li><a href="/categories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a></li>
            <li><a href="/budgets">–ë—é–¥–∂–µ—Ç—ã</a></li>
            <li><a href="/reports">–û—Ç—á–µ—Ç—ã</a></li>
        </ul>
    </nav>
    
    <!-- Main Content -->
    <main class="container">
        <!-- Page Header -->
        <div class="page-header">
            <div class="grid">
                <div>
                    <h1>‚úèÔ∏è {{.PageData.Title}}</h1>
                    <nav aria-label="breadcrumb">
                        <ol>
                            <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
                            <li><a href="/transactions">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</a></li>
                            <li>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</li>
                        </ol>
                    </nav>
                </div>
                <div>
                    {{if .Transaction}}
                    <small class="muted">
                        –°–æ–∑–¥–∞–Ω–∞: {{.Transaction.CreatedAt.Format "02.01.2006 15:04"}}
                    </small>
                    {{end}}
                </div>
            </div>
        </div>
        
        <!-- Error Messages -->
        {{if .PageData.Errors}}
        <div class="alert alert-danger" role="alert" id="form-errors">
            <ul style="margin: 0; padding-left: 1rem;">
                {{range $field, $error := .PageData.Errors}}
                <li>{{$error}}</li>
                {{end}}
            </ul>
        </div>
        {{end}}
        
        <!-- Edit Transaction Form -->
        <section class="form-section">
            <div class="grid">
                <div></div>
                <div>
                    {{if .Transaction}}
                    <form method="POST" 
                          action="/transactions/{{.Transaction.ID}}" 
                          hx-put="/transactions/{{.Transaction.ID}}"
                          hx-target="#form-errors"
                          hx-swap="outerHTML">
                        
                        <input type="hidden" name="_token" value="{{.CSRFToken}}">
                        
                        <!-- Transaction Basic Info -->
                        <fieldset>
                            <legend>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</legend>
                            
                            <div class="grid">
                                <!-- Amount -->
                                <div>
                                    <label for="amount">
                                        –°—É–º–º–∞ (‚ÇΩ) *
                                        <input type="number" 
                                               id="amount" 
                                               name="amount" 
                                               value="{{.Form.Amount}}"
                                               step="0.01"
                                               min="0.01"
                                               placeholder="0.00"
                                               required
                                               autofocus
                                               {{if index .PageData.Errors "amount"}}aria-invalid="true"{{end}}>
                                        {{if index .PageData.Errors "amount"}}
                                        <small class="error">{{index .PageData.Errors "amount"}}</small>
                                        {{end}}
                                    </label>
                                </div>
                                
                                <!-- Type -->
                                <div>
                                    <label for="type">
                                        –¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ *
                                        <select id="type" 
                                                name="type" 
                                                required
                                                onchange="updateCategoryOptions()"
                                                {{if index .PageData.Errors "type"}}aria-invalid="true"{{end}}>
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø...</option>
                                            <option value="income" {{if eq .Form.Type "income"}}selected{{end}}>
                                                üí∞ –î–æ—Ö–æ–¥
                                            </option>
                                            <option value="expense" {{if eq .Form.Type "expense"}}selected{{end}}>
                                                üí∏ –†–∞—Å—Ö–æ–¥
                                            </option>
                                        </select>
                                        {{if index .PageData.Errors "type"}}
                                        <small class="error">{{index .PageData.Errors "type"}}</small>
                                        {{end}}
                                    </label>
                                </div>
                            </div>
                            
                            <div class="grid">
                                <!-- Category -->
                                <div>
                                    <label for="category_id">
                                        –ö–∞—Ç–µ–≥–æ—Ä–∏—è *
                                        <select id="category_id" 
                                                name="category_id" 
                                                required
                                                {{if index .PageData.Errors "category_id"}}aria-invalid="true"{{end}}>
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é...</option>
                                            {{range .CategoryOptions}}
                                            <option value="{{.ID}}" 
                                                    data-type="{{.Type}}"
                                                    {{if eq .ID.String $.Form.CategoryID}}selected{{end}}>
                                                {{.Name}}
                                            </option>
                                            {{end}}
                                        </select>
                                        {{if index .PageData.Errors "category_id"}}
                                        <small class="error">{{index .PageData.Errors "category_id"}}</small>
                                        {{end}}
                                    </label>
                                </div>
                                
                                <!-- Date -->
                                <div>
                                    <label for="date">
                                        –î–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ *
                                        <input type="date" 
                                               id="date" 
                                               name="date" 
                                               value="{{.Form.Date}}"
                                               required
                                               {{if index .PageData.Errors "date"}}aria-invalid="true"{{end}}>
                                        {{if index .PageData.Errors "date"}}
                                        <small class="error">{{index .PageData.Errors "date"}}</small>
                                        {{end}}
                                    </label>
                                </div>
                            </div>
                        </fieldset>
                        
                        <!-- Transaction Details -->
                        <fieldset>
                            <legend>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</legend>
                            
                            <label for="description">
                                –û–ø–∏—Å–∞–Ω–∏–µ *
                                <textarea id="description" 
                                          name="description" 
                                          placeholder="–û–ø–∏—à–∏—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é..."
                                          rows="3"
                                          required
                                          {{if index .PageData.Errors "description"}}aria-invalid="true"{{end}}>{{.Form.Description}}</textarea>
                                {{if index .PageData.Errors "description"}}
                                <small class="error">{{index .PageData.Errors "description"}}</small>
                                {{end}}
                                <small>–ú–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞, –º–∞–∫—Å–∏–º—É–º 500</small>
                            </label>
                            
                            <label for="tags">
                                –¢–µ–≥–∏
                                <input type="text" 
                                       id="tags" 
                                       name="tags" 
                                       value="{{.Form.Tags}}"
                                       placeholder="–ø–æ–∫—É–ø–∫–∏, —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è, —Ä–∞–±–æ—Ç–∞ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)"
                                       {{if index .PageData.Errors "tags"}}aria-invalid="true"{{end}}>
                                {{if index .PageData.Errors "tags"}}
                                <small class="error">{{index .PageData.Errors "tags"}}</small>
                                {{end}}
                                <small>–†–∞–∑–¥–µ–ª—è–π—Ç–µ —Ç–µ–≥–∏ –∑–∞–ø—è—Ç—ã–º–∏. –ú–∞–∫—Å–∏–º—É–º 10 —Ç–µ–≥–æ–≤ –ø–æ 50 —Å–∏–º–≤–æ–ª–æ–≤</small>
                            </label>
                        </fieldset>
                        
                        <!-- Transaction History -->
                        <fieldset>
                            <legend>–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</legend>
                            <div class="grid">
                                <div>
                                    <small class="muted">
                                        <strong>–°–æ–∑–¥–∞–Ω–∞:</strong><br>
                                        {{.Transaction.CreatedAt.Format "02.01.2006 15:04"}}
                                    </small>
                                </div>
                                <div>
                                    <small class="muted">
                                        <strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ:</strong><br>
                                        {{.Transaction.UpdatedAt.Format "02.01.2006 15:04"}}
                                    </small>
                                </div>
                            </div>
                        </fieldset>
                        
                        <!-- Form Actions -->
                        <div class="grid">
                            <div>
                                <a href="/transactions" role="button" class="secondary">
                                    ‚Üê –û—Ç–º–µ–Ω–∞
                                </a>
                            </div>
                            <div>
                                <div class="grid">
                                    <button type="button" 
                                            class="danger outline"
                                            hx-delete="/htmx/transactions/{{.Transaction.ID}}"
                                            hx-confirm="–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é?"
                                            onclick="if(confirm('–£–¥–∞–ª–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é?')) window.location.href='/transactions'">
                                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                    </button>
                                    <button type="submit" class="primary">
                                        ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                    {{else}}
                    <div class="alert alert-danger">
                        <p>–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ —É –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –µ—ë —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.</p>
                        <a href="/transactions" role="button" class="secondary">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É</a>
                    </div>
                    {{end}}
                </div>
                <div></div>
            </div>
        </section>
    </main>
    
    <!-- Footer -->
    <footer class="container">
        <hr>
        <div class="grid">
            <div>
                <small>¬© 2025 –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</small>
            </div>
        </div>
    </footer>
    
    <!-- Custom JavaScript -->
    <script src="/static/js/app.js"></script>
    <script>
        // Filter categories based on selected transaction type
        function updateCategoryOptions() {
            const typeSelect = document.getElementById('type');
            const categorySelect = document.getElementById('category_id');
            const selectedType = typeSelect.value;
            const currentValue = categorySelect.value;
            
            // Show/hide options based on type
            for (let option of categorySelect.options) {
                if (option.value === '') {
                    option.style.display = 'block';
                    continue;
                }
                
                const optionType = option.getAttribute('data-type');
                if (selectedType === '' || optionType === selectedType) {
                    option.style.display = 'block';
                } else {
                    option.style.display = 'none';
                    // Clear selection if hidden
                    if (option.value === currentValue) {
                        categorySelect.value = '';
                    }
                }
            }
        }
        
        // Initialize category filtering on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateCategoryOptions();
        });
    </script>
</body>
</html>
{{end}}