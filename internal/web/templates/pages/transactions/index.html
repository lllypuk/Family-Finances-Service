{{define "pages/transactions/index"}}
<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.PageData.Title}} - –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</title>
    
    <!-- PicoCSS -->
    <link rel="stylesheet" href="/static/css/pico.min.css">
    <link rel="stylesheet" href="/static/css/custom.css">
    
    <!-- HTMX -->
    <script src="/static/js/htmx.min.js"></script>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico">
</head>
<body>
    <!-- Navigation -->
    <nav class="container-fluid">
        <ul>
            <li>
                <a href="/" class="brand">
                    <strong>üí∞ –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</strong>
                </a>
            </li>
        </ul>
        <ul>
            {{if .CurrentUser}}
            <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
            <li><a href="/transactions" class="current">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</a></li>
            <li><a href="/categories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a></li>
            <li><a href="/budgets">–ë—é–¥–∂–µ—Ç—ã</a></li>
            <li><a href="/reports">–û—Ç—á–µ—Ç—ã</a></li>
            <li>
                <details class="dropdown">
                    <summary role="button" class="secondary">
                        {{.CurrentUser.FirstName}} {{.CurrentUser.LastName}}
                    </summary>
                    <ul>
                        <li><a href="/profile">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
                        {{if eq .CurrentUser.Role "admin"}}
                        <li><a href="/users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a></li>
                        <li><a href="/family/settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ–º—å–∏</a></li>
                        {{end}}
                        <li>
                            <form method="POST" action="/logout" style="margin: 0;">
                                <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
                                <button type="submit" class="outline">–í—ã—Ö–æ–¥</button>
                            </form>
                        </li>
                    </ul>
                </details>
            </li>
            {{end}}
        </ul>
    </nav>
    
    <!-- Main Content -->
    <main class="container">
        <!-- Page Header -->
        <div class="page-header">
            <div class="grid">
                <div>
                    <h1>üí≥ {{.PageData.Title}}</h1>
                    <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏</p>
                </div>
                <div>
                    <a href="/transactions/new" role="button" class="primary">
                        ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
                    </a>
                </div>
            </div>
        </div>

        <!-- Filters Section -->
        <section class="filters-section" style="margin-bottom: 2rem;">
            <details>
                <summary role="button" class="secondary outline">
                    üîç –§–∏–ª—å—Ç—Ä—ã {{if .Filters.UserID}}(–∞–∫—Ç–∏–≤–Ω—ã){{end}}
                </summary>
                
                <form method="GET" 
                      action="/transactions"
                      hx-get="/htmx/transactions/filter"
                      hx-target="#transactions-list"
                      hx-swap="innerHTML"
                      hx-trigger="input delay:500ms from:input, change from:select"
                      style="margin-top: 1rem;">
                    
                    <div class="grid">
                        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
                        <div>
                            <label for="category_id">
                                –ö–∞—Ç–µ–≥–æ—Ä–∏—è
                                <select id="category_id" name="category_id">
                                    <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                                    {{range .CategoryOptions}}
                                    <option value="{{.ID}}" {{if eq .ID.String $.Filters.CategoryID}}selected{{end}}>
                                        {{.Name}}
                                    </option>
                                    {{end}}
                                </select>
                            </label>
                        </div>
                        
                        <!-- –¢–∏–ø -->
                        <div>
                            <label for="type">
                                –¢–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
                                <select id="type" name="type">
                                    <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                                    <option value="income" {{if eq .Filters.Type "income"}}selected{{end}}>
                                        üí∞ –î–æ—Ö–æ–¥—ã
                                    </option>
                                    <option value="expense" {{if eq .Filters.Type "expense"}}selected{{end}}>
                                        üí∏ –†–∞—Å—Ö–æ–¥—ã
                                    </option>
                                </select>
                            </label>
                        </div>
                    </div>
                    
                    <div class="grid">
                        <!-- –î–∞—Ç–∞ –æ—Ç -->
                        <div>
                            <label for="date_from">
                                –î–∞—Ç–∞ –æ—Ç
                                <input type="date" 
                                       id="date_from" 
                                       name="date_from" 
                                       value="{{.Filters.DateFrom}}">
                            </label>
                        </div>
                        
                        <!-- –î–∞—Ç–∞ –¥–æ -->
                        <div>
                            <label for="date_to">
                                –î–∞—Ç–∞ –¥–æ
                                <input type="date" 
                                       id="date_to" 
                                       name="date_to" 
                                       value="{{.Filters.DateTo}}">
                            </label>
                        </div>
                    </div>
                    
                    <div class="grid">
                        <!-- –°—É–º–º–∞ –æ—Ç -->
                        <div>
                            <label for="amount_from">
                                –°—É–º–º–∞ –æ—Ç
                                <input type="number" 
                                       id="amount_from" 
                                       name="amount_from" 
                                       value="{{.Filters.AmountFrom}}"
                                       step="0.01"
                                       min="0"
                                       placeholder="0.00">
                            </label>
                        </div>
                        
                        <!-- –°—É–º–º–∞ –¥–æ -->
                        <div>
                            <label for="amount_to">
                                –°—É–º–º–∞ –¥–æ
                                <input type="number" 
                                       id="amount_to" 
                                       name="amount_to" 
                                       value="{{.Filters.AmountTo}}"
                                       step="0.01"
                                       min="0"
                                       placeholder="999999.99">
                            </label>
                        </div>
                    </div>
                    
                    <div class="grid">
                        <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
                        <div>
                            <label for="description">
                                –ü–æ–∏—Å–∫ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏
                                <input type="text" 
                                       id="description" 
                                       name="description" 
                                       value="{{.Filters.Description}}"
                                       placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞">
                            </label>
                        </div>
                        
                        <!-- –¢–µ–≥–∏ -->
                        <div>
                            <label for="tags">
                                –¢–µ–≥–∏
                                <input type="text" 
                                       id="tags" 
                                       name="tags" 
                                       value="{{.Filters.Tags}}"
                                       placeholder="–ø–æ–∫—É–ø–∫–∏, —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)">
                            </label>
                        </div>
                    </div>
                    
                    <div class="grid">
                        <a href="/transactions" role="button" class="secondary outline">
                            üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                        </a>
                        <button type="submit" class="primary">
                            üîç –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                        </button>
                    </div>
                </form>
            </details>
        </section>

        <!-- Bulk Actions -->
        <section class="bulk-actions" style="margin-bottom: 1rem;" id="bulk-actions" hidden>
            <div class="grid">
                <div>
                    <small id="selected-count">–í—ã–±—Ä–∞–Ω–æ: 0</small>
                </div>
                <div>
                    <button type="button" 
                            class="danger outline"
                            hx-delete="/htmx/transactions/bulk-delete"
                            hx-confirm="–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏?"
                            hx-include="[name='transaction_ids']:checked"
                            hx-target="#transactions-list">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ
                    </button>
                </div>
            </div>
        </section>
        
        <!-- Transactions List -->
        <section id="transactions-list">
            {{if .Transactions}}
            <div class="overflow-auto">
                <table role="table">
                    <thead>
                        <tr>
                            <th scope="col">
                                <input type="checkbox" 
                                       id="select-all" 
                                       onchange="toggleSelectAll(this)">
                            </th>
                            <th scope="col">–î–∞—Ç–∞</th>
                            <th scope="col">–û–ø–∏—Å–∞–Ω–∏–µ</th>
                            <th scope="col">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                            <th scope="col">–¢–µ–≥–∏</th>
                            <th scope="col">–°—É–º–º–∞</th>
                            <th scope="col">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{range .Transactions}}
                        <tr>
                            <td>
                                <input type="checkbox" 
                                       name="transaction_ids" 
                                       value="{{.ID}}"
                                       onchange="updateBulkActions()">
                            </td>
                            <td>
                                <time datetime="{{.Date.Format "2006-01-02"}}">
                                    {{.FormattedDate}}
                                </time>
                            </td>
                            <td>
                                <div class="transaction-description">
                                    <strong>{{.Description}}</strong>
                                    {{if .UserName}}
                                    <br><small>–æ—Ç {{.UserName}}</small>
                                    {{end}}
                                </div>
                            </td>
                            <td>
                                <span class="category-badge category-{{.Type}}">
                                    {{if eq .Type "income"}}üí∞{{else}}üí∏{{end}}
                                    {{.CategoryName}}
                                </span>
                            </td>
                            <td>
                                {{if .Tags}}
                                <div class="tags">
                                    {{range .Tags}}
                                    <span class="tag">{{.}}</span>
                                    {{end}}
                                </div>
                                {{else}}
                                <small class="muted">–±–µ–∑ —Ç–µ–≥–æ–≤</small>
                                {{end}}
                            </td>
                            <td>
                                <strong class="amount-{{.Type}}">
                                    {{.FormattedAmount}} ‚ÇΩ
                                </strong>
                            </td>
                            <td>
                                <div class="transaction-actions">
                                    <a href="/transactions/{{.ID}}/edit" 
                                       class="secondary outline" 
                                       title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                        ‚úèÔ∏è
                                    </a>
                                    <button class="danger outline" 
                                            hx-delete="/htmx/transactions/{{.ID}}"
                                            hx-confirm="–£–¥–∞–ª–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é '{{.Description}}'?"
                                            hx-target="closest tr"
                                            hx-swap="outerHTML"
                                            title="–£–¥–∞–ª–∏—Ç—å">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination -->
            {{if .Pagination}}
            <nav class="pagination" style="margin-top: 2rem;">
                <div class="grid">
                    <div>
                        <small>
                            –ü–æ–∫–∞–∑–∞–Ω–æ {{len .Transactions}} –∏–∑ {{.Pagination.Total}}
                        </small>
                    </div>
                    <div>
                        {{if .Pagination.HasPrev}}
                        <a href="?page={{sub .Pagination.Page 1}}{{range $key, $value := .Filters}}{{if $value}}&{{$key}}={{$value}}{{end}}{{end}}" 
                           class="secondary outline">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
                        {{end}}
                        
                        <span class="current-page">
                            –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{.Pagination.Page}} –∏–∑ {{.Pagination.TotalPages}}
                        </span>
                        
                        {{if .Pagination.HasNext}}
                        <a href="?page={{add .Pagination.Page 1}}{{range $key, $value := .Filters}}{{if $value}}&{{$key}}={{$value}}{{end}}{{end}}" 
                           class="secondary outline">–°–ª–µ–¥—É—é—â–∞—è ‚Üí</a>
                        {{end}}
                    </div>
                </div>
            </nav>
            {{end}}
            {{else}}
            <!-- Empty State -->
            <div class="empty-state" style="text-align: center; padding: 3rem;">
                <p style="font-size: 3rem;">üí∏</p>
                <h3>–ü–æ–∫–∞ –Ω–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h3>
                <p>–ù–∞—á–Ω–∏—Ç–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–≤–æ–∏ –¥–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã</p>
                <a href="/transactions/new" role="button" class="primary">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
                </a>
            </div>
            {{end}}
        </section>
    </main>
    
    <!-- Footer -->
    <footer class="container">
        <hr>
        <div class="grid">
            <div>
                <small>¬© 2025 –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</small>
            </div>
        </div>
    </footer>
    
    <!-- Custom JavaScript -->
    <script src="/static/js/app.js"></script>
    <script>
        // Bulk selection logic
        function toggleSelectAll(checkbox) {
            const checkboxes = document.querySelectorAll('input[name="transaction_ids"]');
            checkboxes.forEach(cb => cb.checked = checkbox.checked);
            updateBulkActions();
        }
        
        function updateBulkActions() {
            const checkboxes = document.querySelectorAll('input[name="transaction_ids"]:checked');
            const bulkActions = document.getElementById('bulk-actions');
            const selectedCount = document.getElementById('selected-count');
            
            if (checkboxes.length > 0) {
                bulkActions.hidden = false;
                selectedCount.textContent = `–í—ã–±—Ä–∞–Ω–æ: ${checkboxes.length}`;
            } else {
                bulkActions.hidden = true;
            }
        }
    </script>
</body>
</html>
{{end}}