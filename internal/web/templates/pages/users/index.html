{{define "users/index"}}
<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</title>
    
    <!-- PicoCSS -->
    <link rel="stylesheet" href="/static/css/pico.min.css">
    <link rel="stylesheet" href="/static/css/custom.css">
    
    <!-- HTMX -->
    <script src="/static/js/htmx.min.js"></script>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico">
</head>
<body>
    <!-- Navigation -->
    <nav class="container-fluid">
        <ul>
            <li>
                <a href="/" class="brand">
                    <strong>üí∞ –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</strong>
                </a>
            </li>
        </ul>
        <ul>
            {{if .CurrentUser}}
            <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
            <li><a href="/transactions">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</a></li>
            <li><a href="/categories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a></li>
            <li><a href="/budgets">–ë—é–¥–∂–µ—Ç—ã</a></li>
            <li><a href="/reports">–û—Ç—á–µ—Ç—ã</a></li>
            <li>
                <details class="dropdown">
                    <summary role="button" class="secondary">
                        {{.CurrentUser.FirstName}} {{.CurrentUser.LastName}}
                    </summary>
                    <ul>
                        <li><a href="/profile">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
                        {{if eq .CurrentUser.Role "admin"}}
                        <li><a href="/users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a></li>
                        <li><a href="/family/settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ–º—å–∏</a></li>
                        {{end}}
                        <li>
                            <form method="POST" action="/logout" style="margin: 0;">
                                <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
                                <button type="submit" class="outline">–í—ã—Ö–æ–¥</button>
                            </form>
                        </li>
                    </ul>
                </details>
            </li>
            {{end}}
        </ul>
    </nav>
    
    <!-- Main Content -->
    <main class="container">
        <!-- Page Header -->
        <div class="page-header">
            <div class="grid">
                <div>
                    <h1>üë• {{.Title}}</h1>
                    <p>–°–µ–º—å—è: <strong>{{.Family.Name}}</strong></p>
                </div>
                <div>
                    {{if .CanManage}}
                    <a href="/users/new" role="button" class="primary">
                        ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    </a>
                    {{end}}
                </div>
            </div>
        </div>
        
        <!-- Users List -->
        <section class="users-list">
            {{if .Users}}
            <div class="overflow-auto">
                <table role="table">
                    <thead>
                        <tr>
                            <th scope="col">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                            <th scope="col">Email</th>
                            <th scope="col">–†–æ–ª—å</th>
                            <th scope="col">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                            {{if .CanManage}}
                            <th scope="col">–î–µ–π—Å—Ç–≤–∏—è</th>
                            {{end}}
                        </tr>
                    </thead>
                    <tbody>
                        {{range .Users}}
                        <tr>
                            <td>
                                <div class="user-info">
                                    <strong>{{.FirstName}} {{.LastName}}</strong>
                                    {{if eq .ID $.CurrentUser.ID}}
                                    <small class="badge secondary">–≠—Ç–æ –≤—ã</small>
                                    {{end}}
                                </div>
                            </td>
                            <td>{{.Email}}</td>
                            <td>
                                <span class="role-badge role-{{.Role}}">
                                    {{if eq .Role "admin"}}üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä{{end}}
                                    {{if eq .Role "member"}}üë§ –£—á–∞—Å—Ç–Ω–∏–∫{{end}}
                                    {{if eq .Role "child"}}üßí –†–µ–±–µ–Ω–æ–∫{{end}}
                                </span>
                            </td>
                            <td>
                                <time datetime="{{.CreatedAt.Format "2006-01-02"}}">
                                    {{.CreatedAt.Format "02.01.2006"}}
                                </time>
                            </td>
                            {{if $.CanManage}}
                            <td>
                                <div class="user-actions">
                                    <a href="/users/{{.ID}}" class="secondary outline" title="–ü—Ä–æ—Ñ–∏–ª—å">
                                        üëÅÔ∏è –ü—Ä–æ—Ñ–∏–ª—å
                                    </a>
                                    {{if ne .ID $.CurrentUser.ID}}
                                    <a href="/users/{{.ID}}/edit" class="secondary outline" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                        ‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å
                                    </a>
                                    <button class="danger outline" 
                                            hx-delete="/htmx/users/{{.ID}}"
                                            hx-confirm="–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{.FirstName}} {{.LastName}}?"
                                            hx-target="closest tr"
                                            hx-swap="outerHTML"
                                            title="–£–¥–∞–ª–∏—Ç—å">
                                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                    </button>
                                    {{end}}
                                </div>
                            </td>
                            {{end}}
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
            {{else}}
            <div class="empty-state">
                <p>–í –≤–∞—à–µ–π —Å–µ–º—å–µ –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.</p>
                {{if .CanManage}}
                <a href="/users/new" role="button">–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</a>
                {{end}}
            </div>
            {{end}}
        </section>
    </main>
    
    <!-- Footer -->
    <footer class="container">
        <hr>
        <div class="grid">
            <div>
                <small>
                    ¬© 2025 –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç. 
                    –°–µ–º—å—è: {{.Family.Name}}
                </small>
            </div>
            <div>
                <small class="text-right">
                    <a href="/help">–°–ø—Ä–∞–≤–∫–∞</a> ‚Ä¢ 
                    <a href="/privacy">–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</a> ‚Ä¢ 
                    <a href="/terms">–£—Å–ª–æ–≤–∏—è</a>
                </small>
            </div>
        </div>
    </footer>
    
    <!-- Custom JavaScript -->
    <script src="/static/js/app.js"></script>
</body>
</html>
{{end}}