{{define "users"}}
<!doctype html>
<html lang="ru" data-theme="light">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{{.Title}} - –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</title>

        <!-- PicoCSS -->
        <link rel="stylesheet" href="/static/css/pico.min.css" />
        <link rel="stylesheet" href="/static/css/custom.css" />

        <!-- HTMX -->
        <script src="/static/js/htmx.min.js"></script>

        <!-- Favicon -->
        <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico" />

        <style>
            .user-card,
            .invite-card {
                background: var(--pico-card-background-color);
                border: 1px solid var(--pico-muted-border-color);
                border-radius: var(--pico-border-radius);
                padding: 1rem;
                margin-bottom: 1rem;
            }

            .user-header,
            .invite-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 0.5rem;
            }

            .user-info h4,
            .invite-info h4 {
                margin: 0 0 0.25rem 0;
            }

            .user-meta,
            .invite-meta {
                font-size: 0.85rem;
                color: var(--pico-muted-color);
            }

            .role-badge {
                display: inline-block;
                padding: 0.25rem 0.5rem;
                border-radius: 0.25rem;
                font-size: 0.75rem;
                font-weight: bold;
                text-transform: uppercase;
            }

            .role-admin {
                background: var(--pico-primary-background);
                color: var(--pico-primary-inverse);
            }

            .role-member {
                background: var(--pico-secondary-background);
                color: var(--pico-secondary-inverse);
            }

            .role-child {
                background: var(--pico-contrast-background);
                color: var(--pico-contrast-inverse);
            }

            .status-badge {
                display: inline-block;
                padding: 0.25rem 0.5rem;
                border-radius: 0.25rem;
                font-size: 0.75rem;
                font-weight: bold;
                text-transform: uppercase;
            }

            .status-pending {
                background: #ffd700;
                color: #000;
            }

            .status-expired {
                background: #dc3545;
                color: #fff;
            }

            .status-revoked {
                background: #6c757d;
                color: #fff;
            }

            .invite-form {
                background: var(--pico-card-background-color);
                border: 2px dashed var(--pico-primary);
                border-radius: var(--pico-border-radius);
                padding: 1.5rem;
                margin-bottom: 2rem;
            }

            .invite-link {
                background: var(--pico-code-background-color);
                padding: 0.5rem;
                border-radius: var(--pico-border-radius);
                font-family: monospace;
                font-size: 0.85rem;
                word-break: break-all;
                margin-top: 0.5rem;
            }

            .section-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1rem;
            }

            .section-header h2 {
                margin: 0;
            }

            .user-actions,
            .invite-actions {
                display: flex;
                gap: 0.5rem;
            }

            .delete-btn {
                background: var(--pico-del-color);
                border-color: var(--pico-del-color);
            }

            .delete-btn:hover {
                background: var(--pico-del-hover-background-color);
            }

            @media (max-width: 768px) {
                .user-header,
                .invite-header {
                    flex-direction: column;
                    align-items: flex-start;
                }

                .user-actions,
                .invite-actions {
                    margin-top: 0.5rem;
                    width: 100%;
                }

                .user-actions button,
                .invite-actions button {
                    flex: 1;
                }
            }
        </style>
    </head>
    <body>
        <!-- Navigation -->
        <nav class="container-fluid">
            <ul>
                <li>
                    <a href="/" class="brand">
                        <strong>üí∞ –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</strong>
                    </a>
                </li>
            </ul>
            <ul>
                <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="/transactions">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</a></li>
                <li><a href="/categories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a></li>
                <li><a href="/budgets">–ë—é–¥–∂–µ—Ç—ã</a></li>
                <li><a href="/reports">–û—Ç—á–µ—Ç—ã</a></li>
                <li>
                    <details class="dropdown">
                        <summary role="button" class="secondary">
                            {{.CurrentUser.FirstName}} {{.CurrentUser.LastName}}
                        </summary>
                        <ul>
                            <li><a href="/profile">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
                            <li>
                                <a href="/admin/users" aria-current="page"
                                    >–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a
                                >
                            </li>
                            <li>
                                <a href="/family/settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ–º—å–∏</a>
                            </li>
                            <li>
                                <form
                                    method="POST"
                                    action="/logout"
                                    style="margin: 0"
                                >
                                    <input
                                        type="hidden"
                                        name="_token"
                                        value="{{.CSRFToken}}"
                                    />
                                    <button type="submit" class="outline">
                                        –í—ã—Ö–æ–¥
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </details>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="container">
            <header>
                <h1>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h1>
                <p>
                    –£–ø—Ä–∞–≤–ª—è–π—Ç–µ —á–ª–µ–Ω–∞–º–∏ —Å–µ–º—å–∏ "{{.Family.Name}}" –∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è–º–∏
                </p>
            </header>

            <!-- Invite Form -->
            <section class="invite-form">
                <h3>‚úâÔ∏è –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</h3>
                <form
                    hx-post="/admin/users/invite"
                    hx-target="#invites-list"
                    hx-swap="afterbegin"
                    hx-on::after-request="if(event.detail.successful) this.reset()"
                >
                    <input type="hidden" name="_token" value="{{.CSRFToken}}" />

                    <div class="grid">
                        <div>
                            <label for="email">Email</label>
                            <input
                                type="email"
                                id="email"
                                name="email"
                                placeholder="user@example.com"
                                required
                            />
                        </div>
                        <div>
                            <label for="role">–†–æ–ª—å</label>
                            <select id="role" name="role" required>
                                {{range .Roles}}
                                <option value="{{.}}">{{.}}</option>
                                {{end}}
                            </select>
                        </div>
                    </div>

                    <button type="submit">
                        <span class="htmx-indicator">üîÑ</span>
                        –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
                    </button>
                </form>
                <small>–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤ —Ç–µ—á–µ–Ω–∏–µ 7 –¥–Ω–µ–π</small>
            </section>

            <!-- Active Invites -->
            <section>
                <div class="section-header">
                    <h2>üì® –ê–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è</h2>
                    <span class="role-badge status-pending"
                        >{{len .Invites}} –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π</span
                    >
                </div>

                <div id="invites-list">
                    {{if .Invites}} {{range .Invites}} {{template
                    "admin/invite_row.html" map "Invite" . "CSRFToken"
                    $.CSRFToken}} {{end}} {{else}}
                    <article>
                        <p
                            style="
                                text-align: center;
                                color: var(--pico-muted-color);
                            "
                        >
                            –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
                        </p>
                    </article>
                    {{end}}
                </div>
            </section>

            <!-- Users List -->
            <section style="margin-top: 2rem">
                <div class="section-header">
                    <h2>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ –ß–ª–µ–Ω—ã —Å–µ–º—å–∏</h2>
                    <span class="role-badge role-member"
                        >{{len .Users}} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</span
                    >
                </div>

                <div id="users-list">
                    {{range .Users}}
                    <article class="user-card" id="user-{{.ID}}">
                        <div class="user-header">
                            <div class="user-info">
                                <h4>{{.FirstName}} {{.LastName}}</h4>
                                <div class="user-meta">
                                    <span>üìß {{.Email}}</span> ‚Ä¢ {{if eq .Role
                                    "admin"}}
                                    <span class="role-badge role-admin"
                                        >–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span
                                    >
                                    {{else if eq .Role "member"}}
                                    <span class="role-badge role-member"
                                        >–£—á–∞—Å—Ç–Ω–∏–∫</span
                                    >
                                    {{else if eq .Role "child"}}
                                    <span class="role-badge role-child"
                                        >–†–µ–±–µ–Ω–æ–∫</span
                                    >
                                    {{end}}
                                </div>
                            </div>
                            <div class="user-actions">
                                {{if ne .ID $.CurrentUser.ID}}
                                <button
                                    class="secondary outline"
                                    hx-delete="/admin/users/{{.ID}}"
                                    hx-confirm="–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{.FirstName}} {{.LastName}}?"
                                    hx-target="#user-{{.ID}}"
                                    hx-swap="outerHTML swap:1s"
                                >
                                    –£–¥–∞–ª–∏—Ç—å
                                </button>
                                {{else}}
                                <span class="role-badge status-pending"
                                    >–≠—Ç–æ –≤—ã</span
                                >
                                {{end}}
                            </div>
                        </div>
                    </article>
                    {{end}}
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="container">
            <hr />
            <div class="grid">
                <div>
                    <small
                        >¬© 2025 –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç. –°–µ–º—å—è: {{.Family.Name}}</small
                    >
                </div>
                <div>
                    <small style="text-align: right">
                        <a href="/help">–°–ø—Ä–∞–≤–∫–∞</a> ‚Ä¢
                        <a href="/privacy">–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</a> ‚Ä¢
                        <a href="/terms">–£—Å–ª–æ–≤–∏—è</a>
                    </small>
                </div>
            </div>
        </footer>

        <!-- Custom JavaScript -->
        <script src="/static/js/app.js"></script>
    </body>
</html>
{{end}}
